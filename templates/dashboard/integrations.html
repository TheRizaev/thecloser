{% extends 'dashboard/base.html' %}

{% block title %}–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ ‚Äî CRM{% endblock %}

{% block extra_css %}
<style>
/* ============================================
   INTEGRATIONS PAGE STYLES
   ============================================ */

.integrations-header {
    margin-bottom: 40px;
}

.integrations-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
    gap: 24px;
    margin-bottom: 40px;
}

/* Integration Card */
.integration-card {
    background: var(--dash-surface);
    backdrop-filter: blur(20px);
    border: 1px solid var(--dash-border);
    border-radius: 20px;
    overflow: hidden;
    transition: all 0.3s ease;
}

.integration-card:hover {
    border-color: rgba(99, 102, 241, 0.3);
    transform: translateY(-4px);
    box-shadow: 0 12px 40px rgba(0, 0, 0, 0.3);
}

.integration-card.connected {
    border-color: rgba(34, 197, 94, 0.3);
}

/* Card Header */
.integration-header {
    padding: 28px;
    display: flex;
    align-items: center;
    gap: 20px;
    border-bottom: 1px solid var(--dash-border);
    position: relative;
}

.integration-logo {
    width: 64px;
    height: 64px;
    border-radius: 16px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 32px;
    flex-shrink: 0;
}

.integration-logo.bitrix {
    background: linear-gradient(135deg, #2FC7F7 0%, #00AEEF 100%);
    color: white;
}

.integration-logo.amocrm {
    background: linear-gradient(135deg, #FED100 0%, #F5A623 100%);
    color: white;
}

.integration-logo.moysklad {
    background: linear-gradient(135deg, #4CAF50 0%, #2E7D32 100%);
    color: white;
}

.integration-logo.google-sheets {
    background: linear-gradient(135deg, #0F9D58 0%, #188038 100%);
    color: white;
}

.integration-info h3 {
    font-size: 20px;
    font-weight: 700;
    margin: 0 0 6px 0;
    color: var(--dash-text);
}

.integration-info p {
    font-size: 14px;
    color: var(--dash-text-muted);
    margin: 0;
}

.integration-status {
    position: absolute;
    top: 20px;
    right: 20px;
}

.status-pill {
    display: inline-flex;
    align-items: center;
    gap: 6px;
    padding: 6px 14px;
    border-radius: 20px;
    font-size: 12px;
    font-weight: 600;
}

.status-pill.connected {
    background: rgba(34, 197, 94, 0.1);
    color: #22c55e;
    border: 1px solid rgba(34, 197, 94, 0.2);
}

.status-pill.disconnected {
    background: rgba(148, 163, 184, 0.1);
    color: var(--dash-text-muted);
    border: 1px solid var(--dash-border);
}

.status-pill .status-dot {
    width: 8px;
    height: 8px;
    border-radius: 50%;
    background: currentColor;
}

/* Card Body */
.integration-body {
    padding: 28px;
}

/* Features List */
.features-list {
    display: flex;
    flex-wrap: wrap;
    gap: 10px;
    margin-bottom: 24px;
}

.feature-tag {
    display: inline-flex;
    align-items: center;
    gap: 6px;
    padding: 6px 12px;
    background: rgba(255, 255, 255, 0.03);
    border: 1px solid var(--dash-border);
    border-radius: 8px;
    font-size: 12px;
    color: var(--dash-text-muted);
}

.feature-tag i {
    color: var(--dash-primary);
    font-size: 10px;
}

/* Connection Form */
.connection-form {
    display: none;
    animation: slideDown 0.3s ease;
}

.connection-form.active {
    display: block;
}

@keyframes slideDown {
    from {
        opacity: 0;
        transform: translateY(-10px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}

.form-section {
    margin-bottom: 20px;
}

.form-section-title {
    font-size: 13px;
    font-weight: 600;
    color: var(--dash-text-muted);
    text-transform: uppercase;
    letter-spacing: 0.5px;
    margin-bottom: 12px;
    display: flex;
    align-items: center;
    gap: 8px;
}

.form-section-title i {
    color: var(--dash-primary);
}

.form-input-group {
    margin-bottom: 16px;
}

.form-input-group label {
    display: block;
    font-size: 14px;
    font-weight: 500;
    color: var(--dash-text);
    margin-bottom: 8px;
}

.form-input-group .input-hint {
    font-size: 12px;
    color: var(--dash-text-muted);
    margin-top: 6px;
    line-height: 1.5;
}

.form-input-group .input-hint a {
    color: var(--dash-primary);
    text-decoration: none;
}

.form-input-group .input-hint a:hover {
    text-decoration: underline;
}

/* Info Box */
.info-box {
    background: rgba(99, 102, 241, 0.05);
    border: 1px solid rgba(99, 102, 241, 0.2);
    border-radius: 12px;
    padding: 16px;
    margin-bottom: 20px;
}

.info-box.warning {
    background: rgba(245, 158, 11, 0.05);
    border-color: rgba(245, 158, 11, 0.2);
}

.info-box-header {
    display: flex;
    align-items: center;
    gap: 10px;
    margin-bottom: 10px;
}

.info-box-header i {
    color: var(--dash-primary);
    font-size: 16px;
}

.info-box.warning .info-box-header i {
    color: #f59e0b;
}

.info-box-header h4 {
    font-size: 14px;
    font-weight: 600;
    margin: 0;
    color: var(--dash-text);
}

.info-box p {
    font-size: 13px;
    color: var(--dash-text-muted);
    margin: 0;
    line-height: 1.6;
}

.info-box ol, .info-box ul {
    font-size: 13px;
    color: var(--dash-text-muted);
    margin: 10px 0 0 20px;
    padding: 0;
    line-height: 1.8;
}

.info-box a {
    color: var(--dash-primary);
    text-decoration: none;
}

.info-box a:hover {
    text-decoration: underline;
}

/* Connected State */
.connected-info {
    background: rgba(34, 197, 94, 0.05);
    border: 1px solid rgba(34, 197, 94, 0.2);
    border-radius: 12px;
    padding: 20px;
    margin-bottom: 20px;
}

.connected-info-row {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 10px 0;
    border-bottom: 1px solid rgba(255, 255, 255, 0.05);
}

.connected-info-row:last-child {
    border-bottom: none;
}

.connected-info-label {
    font-size: 13px;
    color: var(--dash-text-muted);
}

.connected-info-value {
    font-size: 14px;
    font-weight: 600;
    color: var(--dash-text);
}

/* Buttons */
.integration-actions {
    display: flex;
    gap: 12px;
    margin-top: 24px;
}

.btn-connect {
    flex: 1;
    padding: 14px 24px;
    background: linear-gradient(135deg, var(--dash-primary), #7c3aed);
    color: white;
    border: none;
    border-radius: 12px;
    font-size: 14px;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.2s ease;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 8px;
}

.btn-connect:hover {
    transform: translateY(-2px);
    box-shadow: 0 8px 24px rgba(99, 102, 241, 0.4);
}

.btn-connect:disabled {
    opacity: 0.6;
    cursor: not-allowed;
    transform: none;
}

.btn-disconnect {
    padding: 14px 24px;
    background: rgba(239, 68, 68, 0.1);
    color: var(--dash-error);
    border: 1px solid rgba(239, 68, 68, 0.2);
    border-radius: 12px;
    font-size: 14px;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.2s ease;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 8px;
}

.btn-disconnect:hover {
    background: rgba(239, 68, 68, 0.2);
}

.btn-test {
    padding: 14px 24px;
    background: rgba(255, 255, 255, 0.05);
    color: var(--dash-text);
    border: 1px solid var(--dash-border);
    border-radius: 12px;
    font-size: 14px;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.2s ease;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 8px;
}

.btn-test:hover {
    background: rgba(255, 255, 255, 0.08);
}

.btn-toggle-form {
    width: 100%;
    padding: 14px 24px;
    background: rgba(255, 255, 255, 0.05);
    color: var(--dash-text);
    border: 1px solid var(--dash-border);
    border-radius: 12px;
    font-size: 14px;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.2s ease;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 8px;
}

.btn-toggle-form:hover {
    background: rgba(255, 255, 255, 0.08);
    border-color: var(--dash-primary);
}

/* Error/Success Messages */
.message-box {
    padding: 14px 16px;
    border-radius: 10px;
    margin-bottom: 16px;
    display: flex;
    align-items: center;
    gap: 10px;
    font-size: 14px;
}

.message-box.error {
    background: rgba(239, 68, 68, 0.1);
    border: 1px solid rgba(239, 68, 68, 0.2);
    color: #fca5a5;
}

.message-box.success {
    background: rgba(34, 197, 94, 0.1);
    border: 1px solid rgba(34, 197, 94, 0.2);
    color: #86efac;
}

.message-box i {
    font-size: 16px;
}

/* Tabs */
.connection-tabs {
    display: flex;
    gap: 8px;
    margin-bottom: 20px;
    padding: 4px;
    background: rgba(255, 255, 255, 0.03);
    border-radius: 10px;
}

.connection-tab {
    flex: 1;
    padding: 10px 16px;
    background: transparent;
    border: none;
    border-radius: 8px;
    color: var(--dash-text-muted);
    font-size: 13px;
    font-weight: 500;
    cursor: pointer;
    transition: all 0.2s ease;
}

.connection-tab.active {
    background: var(--dash-primary);
    color: white;
}

.connection-tab:hover:not(.active) {
    background: rgba(255, 255, 255, 0.05);
    color: var(--dash-text);
}

.tab-content {
    display: none;
}

.tab-content.active {
    display: block;
}

/* Stats Row */
.stats-row {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 16px;
    margin-top: 20px;
}

.stat-mini-card {
    background: rgba(255, 255, 255, 0.03);
    border: 1px solid var(--dash-border);
    border-radius: 12px;
    padding: 16px;
    text-align: center;
}

.stat-mini-card .stat-value {
    font-size: 24px;
    font-weight: 700;
    color: var(--dash-text);
    margin-bottom: 4px;
}

.stat-mini-card .stat-label {
    font-size: 12px;
    color: var(--dash-text-muted);
}

/* Responsive */
@media (max-width: 900px) {
    .integrations-grid {
        grid-template-columns: 1fr;
    }
}

@media (max-width: 600px) {
    .integration-header {
        flex-direction: column;
        text-align: center;
    }
    
    .integration-status {
        position: static;
        margin-top: 12px;
    }
    
    .integration-actions {
        flex-direction: column;
    }
    
    .stats-row {
        grid-template-columns: 1fr;
    }
}
</style>
{% endblock %}

{% block content %}
<div class="page-header integrations-header">
    <div>
        <h1 class="page-title">üîó –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏</h1>
        <p class="page-subtitle">–ü–æ–¥–∫–ª—é—á–∏—Ç–µ CRM —Å–∏—Å—Ç–µ–º—ã –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –ø–µ—Ä–µ–¥–∞—á–∏ –ª–∏–¥–æ–≤</p>
    </div>
</div>

<div class="integrations-grid">
    <!-- Bitrix24 Card -->
    <div class="integration-card {% if bitrix and bitrix.is_connected %}connected{% endif %}" id="bitrix-card">
        <div class="integration-header">
            <div class="integration-logo bitrix">
                <i class="fa-solid fa-b"></i>
            </div>
            <div class="integration-info">
                <h3>Bitrix24</h3>
                <p>–ü–æ–ø—É–ª—è—Ä–Ω–∞—è CRM –¥–ª—è –±–∏–∑–Ω–µ—Å–∞</p>
            </div>
            <div class="integration-status">
                <span class="status-pill {% if bitrix and bitrix.is_connected %}connected{% else %}disconnected{% endif %}" id="bitrix-status">
                    <span class="status-dot"></span>
                    {% if bitrix and bitrix.is_connected %}–ü–æ–¥–∫–ª—é—á–µ–Ω–æ{% else %}–ù–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–æ{% endif %}
                </span>
            </div>
        </div>
        
        <div class="integration-body">
            <div class="features-list">
                <span class="feature-tag"><i class="fa-solid fa-check"></i> –°–æ–∑–¥–∞–Ω–∏–µ –ª–∏–¥–æ–≤</span>
                <span class="feature-tag"><i class="fa-solid fa-check"></i> –°–æ–∑–¥–∞–Ω–∏–µ —Å–¥–µ–ª–æ–∫</span>
                <span class="feature-tag"><i class="fa-solid fa-check"></i> –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –∫–æ–Ω—Ç–∞–∫—Ç–æ–≤</span>
                <span class="feature-tag"><i class="fa-solid fa-check"></i> Webhook –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è</span>
            </div>
            
            <!-- Disconnected State -->
            <div id="bitrix-disconnected" {% if bitrix and bitrix.is_connected %}style="display:none"{% endif %}>
                <button class="btn-toggle-form" onclick="toggleBitrixForm()">
                    <i class="fa-solid fa-plug"></i>
                    –ü–æ–¥–∫–ª—é—á–∏—Ç—å Bitrix24
                </button>
                
                <div class="connection-form" id="bitrix-form">
                    <div class="info-box">
                        <div class="info-box-header">
                            <i class="fa-solid fa-circle-info"></i>
                            <h4>–ö–∞–∫ –ø–æ–ª—É—á–∏—Ç—å Webhook URL?</h4>
                        </div>
                        <ol>
                            <li>–û—Ç–∫—Ä–æ–π—Ç–µ –≤–∞—à Bitrix24 –ø–æ—Ä—Ç–∞–ª</li>
                            <li>–ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ <strong>–ü—Ä–∏–ª–æ–∂–µ–Ω–∏—è ‚Üí –†–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∞–º ‚Üí –î—Ä—É–≥–æ–µ ‚Üí –í—Ö–æ–¥—è—â–∏–π –≤–µ–±—Ö—É–∫</strong></li>
                            <li>–ù–∞–∂–º–∏—Ç–µ <strong>–î–æ–±–∞–≤–∏—Ç—å –≤–µ–±—Ö—É–∫</strong></li>
                            <li>–í—ã–±–µ—Ä–∏—Ç–µ –ø—Ä–∞–≤–∞: <strong>CRM, –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏</strong></li>
                            <li>–°–∫–æ–ø–∏—Ä—É–π—Ç–µ –ø–æ–ª—É—á–µ–Ω–Ω—ã–π URL</li>
                        </ol>
                    </div>
                    
                    <div class="form-input-group">
                        <label>Webhook URL</label>
                        <input 
                            type="text" 
                            id="bitrix-webhook" 
                            class="form-input" 
                            placeholder="https://–≤–∞—à-–¥–æ–º–µ–Ω.bitrix24.ru/rest/1/xxx..."
                        >
                        <p class="input-hint">
                            URL –¥–æ–ª–∂–µ–Ω –Ω–∞—á–∏–Ω–∞—Ç—å—Å—è —Å https:// –∏ —Å–æ–¥–µ—Ä–∂–∞—Ç—å /rest/
                        </p>
                    </div>
                    
                    <div id="bitrix-error" class="message-box error" style="display:none">
                        <i class="fa-solid fa-circle-exclamation"></i>
                        <span></span>
                    </div>
                    
                    <div id="bitrix-success" class="message-box success" style="display:none">
                        <i class="fa-solid fa-check-circle"></i>
                        <span></span>
                    </div>
                    
                    <div class="integration-actions">
                        <button class="btn-connect" onclick="connectBitrix24()" id="bitrix-connect-btn">
                            <i class="fa-solid fa-link"></i>
                            –ü–æ–¥–∫–ª—é—á–∏—Ç—å
                        </button>
                    </div>
                </div>
            </div>
            
            <!-- Connected State -->
            <div id="bitrix-connected" {% if not bitrix or not bitrix.is_connected %}style="display:none"{% endif %}>
                <div class="connected-info">
                    <div class="connected-info-row">
                        <span class="connected-info-label">–°—Ç–∞—Ç—É—Å</span>
                        <span class="connected-info-value" style="color: #22c55e;">
                            <i class="fa-solid fa-circle" style="font-size: 8px; margin-right: 6px;"></i>
                            –ê–∫—Ç–∏–≤–Ω–æ
                        </span>
                    </div>
                    <div class="connected-info-row">
                        <span class="connected-info-label">–î–æ–º–µ–Ω</span>
                        <span class="connected-info-value" id="bitrix-domain">{% if bitrix %}{{ bitrix.domain }}{% endif %}</span>
                    </div>
                    <div class="connected-info-row">
                        <span class="connected-info-label">–ü–æ–¥–∫–ª—é—á–µ–Ω–æ</span>
                        <span class="connected-info-value" id="bitrix-connected-at">{% if bitrix %}{{ bitrix.created_at|date:"d.m.Y H:i" }}{% endif %}</span>
                    </div>
                </div>
                
                <div class="stats-row">
                    <div class="stat-mini-card">
                        <div class="stat-value" id="bitrix-leads-count">{% if bitrix %}{{ bitrix.leads_synced }}{% else %}0{% endif %}</div>
                        <div class="stat-label">–õ–∏–¥–æ–≤ –ø–µ—Ä–µ–¥–∞–Ω–æ</div>
                    </div>
                    <div class="stat-mini-card">
                        <div class="stat-value">0</div>
                        <div class="stat-label">–°–¥–µ–ª–æ–∫ —Å–æ–∑–¥–∞–Ω–æ</div>
                    </div>
                    <div class="stat-mini-card">
                        <div class="stat-value">100%</div>
                        <div class="stat-label">–£—Å–ø–µ—à–Ω–æ—Å—Ç—å</div>
                    </div>
                </div>
                
                <div class="integration-actions">
                    <button class="btn-test" onclick="testBitrix24()">
                        <i class="fa-solid fa-vial"></i>
                        –¢–µ—Å—Ç
                    </button>
                    <button class="btn-disconnect" onclick="disconnectBitrix24()">
                        <i class="fa-solid fa-unlink"></i>
                        –û—Ç–∫–ª—é—á–∏—Ç—å
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- AmoCRM Card -->
    <div class="integration-card {% if amocrm and amocrm.is_connected %}connected{% endif %}" id="amocrm-card">
        <div class="integration-header">
            <div class="integration-logo amocrm">
                <i class="fa-solid fa-a"></i>
            </div>
            <div class="integration-info">
                <h3>AmoCRM</h3>
                <p>CRM –¥–ª—è –æ—Ç–¥–µ–ª–∞ –ø—Ä–æ–¥–∞–∂</p>
            </div>
            <div class="integration-status">
                <span class="status-pill {% if amocrm and amocrm.is_connected %}connected{% else %}disconnected{% endif %}" id="amocrm-status">
                    <span class="status-dot"></span>
                    {% if amocrm and amocrm.is_connected %}–ü–æ–¥–∫–ª—é—á–µ–Ω–æ{% else %}–ù–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–æ{% endif %}
                </span>
            </div>
        </div>
        
        <div class="integration-body">
            <div class="features-list">
                <span class="feature-tag"><i class="fa-solid fa-check"></i> –°–æ–∑–¥–∞–Ω–∏–µ —Å–¥–µ–ª–æ–∫</span>
                <span class="feature-tag"><i class="fa-solid fa-check"></i> –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–æ–Ω—Ç–∞–∫—Ç–∞–º–∏</span>
                <span class="feature-tag"><i class="fa-solid fa-check"></i> –í–æ—Ä–æ–Ω–∫–∏ –ø—Ä–æ–¥–∞–∂</span>
                <span class="feature-tag"><i class="fa-solid fa-check"></i> OAuth 2.0</span>
            </div>
            
            <!-- Disconnected State -->
            <div id="amocrm-disconnected" {% if amocrm and amocrm.is_connected %}style="display:none"{% endif %}>
                <button class="btn-toggle-form" onclick="toggleAmoCRMForm()">
                    <i class="fa-solid fa-plug"></i>
                    –ü–æ–¥–∫–ª—é—á–∏—Ç—å AmoCRM
                </button>
                
                <div class="connection-form" id="amocrm-form">
                    <!-- Connection Method Tabs -->
                    <div class="connection-tabs">
                        <button class="connection-tab active" onclick="switchAmoCRMTab('oauth')">OAuth 2.0</button>
                        <button class="connection-tab" onclick="switchAmoCRMTab('apikey')">API Key (Legacy)</button>
                    </div>
                    
                    <!-- OAuth Method -->
                    <div class="tab-content active" id="amocrm-oauth-tab">
                        <div class="info-box">
                            <div class="info-box-header">
                                <i class="fa-solid fa-circle-info"></i>
                                <h4>–ö–∞–∫ –ø–æ–ª—É—á–∏—Ç—å –¥–∞–Ω–Ω—ã–µ OAuth?</h4>
                            </div>
                            <ol>
                                <li>–ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ <a href="https://www.amocrm.ru/developers/content/oauth/step-by-step" target="_blank">AmoCRM ‚Üí –ù–∞—Å—Ç—Ä–æ–π–∫–∏ ‚Üí –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏</a></li>
                                <li>–°–æ–∑–¥–∞–π—Ç–µ –Ω–æ–≤—É—é –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—é</li>
                                <li>–°–∫–æ–ø–∏—Ä—É–π—Ç–µ <strong>Client ID</strong> –∏ <strong>Client Secret</strong></li>
                                <li>–£–∫–∞–∂–∏—Ç–µ Redirect URI –∏ –ø–æ–ª—É—á–∏—Ç–µ –∫–æ–¥ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏</li>
                            </ol>
                        </div>
                        
                        <div class="form-input-group">
                            <label>–ü–æ–¥–¥–æ–º–µ–Ω AmoCRM</label>
                            <input 
                                type="text" 
                                id="amocrm-subdomain" 
                                class="form-input" 
                                placeholder="mycompany"
                            >
                            <p class="input-hint">–¢–æ–ª—å–∫–æ –Ω–∞–∑–≤–∞–Ω–∏–µ –±–µ–∑ .amocrm.ru (–Ω–∞–ø—Ä–∏–º–µ—Ä: mycompany)</p>
                        </div>
                        
                        <div class="form-input-group">
                            <label>Client ID (ID –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏)</label>
                            <input 
                                type="text" 
                                id="amocrm-client-id" 
                                class="form-input" 
                                placeholder="xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx"
                            >
                        </div>
                        
                        <div class="form-input-group">
                            <label>Client Secret</label>
                            <input 
                                type="password" 
                                id="amocrm-client-secret" 
                                class="form-input" 
                                placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢"
                            >
                        </div>
                        
                        <div class="form-input-group">
                            <label>–ö–æ–¥ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏</label>
                            <input 
                                type="text" 
                                id="amocrm-auth-code" 
                                class="form-input" 
                                placeholder="def50200..."
                            >
                            <p class="input-hint">–ü–æ–ª—É—á–∏—Ç–µ –∫–æ–¥ –ø–æ—Å–ª–µ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –≤ AmoCRM</p>
                        </div>
                    </div>
                    
                    <!-- API Key Method (Legacy) -->
                    <div class="tab-content" id="amocrm-apikey-tab">
                        <div class="info-box warning">
                            <div class="info-box-header">
                                <i class="fa-solid fa-triangle-exclamation"></i>
                                <h4>–£—Å—Ç–∞—Ä–µ–≤—à–∏–π –º–µ—Ç–æ–¥</h4>
                            </div>
                            <p>API Key –±–æ–ª—å—à–µ –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è AmoCRM –¥–ª—è –Ω–æ–≤—ã—Ö –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–π. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ OAuth 2.0 –µ—Å–ª–∏ –≤–æ–∑–º–æ–∂–Ω–æ.</p>
                        </div>
                        
                        <div class="form-input-group">
                            <label>–ü–æ–¥–¥–æ–º–µ–Ω</label>
                            <input 
                                type="text" 
                                id="amocrm-subdomain-legacy" 
                                class="form-input" 
                                placeholder="mycompany"
                            >
                        </div>
                        
                        <div class="form-input-group">
                            <label>Email –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</label>
                            <input 
                                type="email" 
                                id="amocrm-email" 
                                class="form-input" 
                                placeholder="user@company.com"
                            >
                        </div>
                        
                        <div class="form-input-group">
                            <label>API Key (Hash)</label>
                            <input 
                                type="password" 
                                id="amocrm-api-key" 
                                class="form-input" 
                                placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢"
                            >
                            <p class="input-hint">–ù–∞–π–¥–∏—Ç–µ –≤ –ü—Ä–æ—Ñ–∏–ª—å ‚Üí API ‚Üí –í–∞—à API –∫–ª—é—á</p>
                        </div>
                    </div>
                    
                    <div id="amocrm-error" class="message-box error" style="display:none">
                        <i class="fa-solid fa-circle-exclamation"></i>
                        <span></span>
                    </div>
                    
                    <div id="amocrm-success" class="message-box success" style="display:none">
                        <i class="fa-solid fa-check-circle"></i>
                        <span></span>
                    </div>
                    
                    <div class="integration-actions">
                        <button class="btn-connect" onclick="connectAmoCRM()" id="amocrm-connect-btn">
                            <i class="fa-solid fa-link"></i>
                            –ü–æ–¥–∫–ª—é—á–∏—Ç—å
                        </button>
                    </div>
                </div>
            </div>
            
            <!-- Connected State -->
            <div id="amocrm-connected" {% if not amocrm or not amocrm.is_connected %}style="display:none"{% endif %}>
                <div class="connected-info">
                    <div class="connected-info-row">
                        <span class="connected-info-label">–°—Ç–∞—Ç—É—Å</span>
                        <span class="connected-info-value" style="color: #22c55e;">
                            <i class="fa-solid fa-circle" style="font-size: 8px; margin-right: 6px;"></i>
                            –ê–∫—Ç–∏–≤–Ω–æ
                        </span>
                    </div>
                    <div class="connected-info-row">
                        <span class="connected-info-label">–ê–∫–∫–∞—É–Ω—Ç</span>
                        <span class="connected-info-value" id="amocrm-account">{% if amocrm %}{{ amocrm.domain }}{% endif %}</span>
                    </div>
                    <div class="connected-info-row">
                        <span class="connected-info-label">–ü–æ–¥–∫–ª—é—á–µ–Ω–æ</span>
                        <span class="connected-info-value" id="amocrm-connected-at">{% if amocrm %}{{ amocrm.created_at|date:"d.m.Y H:i" }}{% endif %}</span>
                    </div>
                </div>
                
                <div class="stats-row">
                    <div class="stat-mini-card">
                        <div class="stat-value" id="amocrm-leads-count">{% if amocrm %}{{ amocrm.leads_synced }}{% else %}0{% endif %}</div>
                        <div class="stat-label">–°–¥–µ–ª–æ–∫ —Å–æ–∑–¥–∞–Ω–æ</div>
                    </div>
                    <div class="stat-mini-card">
                        <div class="stat-value">0</div>
                        <div class="stat-label">–ö–æ–Ω—Ç–∞–∫—Ç–æ–≤</div>
                    </div>
                    <div class="stat-mini-card">
                        <div class="stat-value">100%</div>
                        <div class="stat-label">–£—Å–ø–µ—à–Ω–æ—Å—Ç—å</div>
                    </div>
                </div>
                
                <div class="integration-actions">
                    <button class="btn-test" onclick="testAmoCRM()">
                        <i class="fa-solid fa-vial"></i>
                        –¢–µ—Å—Ç
                    </button>
                    <button class="btn-disconnect" onclick="disconnectAmoCRM()">
                        <i class="fa-solid fa-unlink"></i>
                        –û—Ç–∫–ª—é—á–∏—Ç—å
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- –ú–æ–π–°–∫–ª–∞–¥ Card -->
    <div class="integration-card {% if moysklad and moysklad.is_connected %}connected{% endif %}" id="moysklad-card">
        <div class="integration-header">
            <div class="integration-logo moysklad">
                <i class="fa-solid fa-warehouse"></i>
            </div>
            <div class="integration-info">
                <h3>–ú–æ–π–°–∫–ª–∞–¥</h3>
                <p>–£—á—ë—Ç —Ç–æ–≤–∞—Ä–æ–≤ –∏ —Å–∫–ª–∞–¥–æ–≤</p>
            </div>
            <div class="integration-status">
                <span class="status-pill {% if moysklad and moysklad.is_connected %}connected{% else %}disconnected{% endif %}" id="moysklad-status">
                    <span class="status-dot"></span>
                    {% if moysklad and moysklad.is_connected %}–ü–æ–¥–∫–ª—é—á–µ–Ω–æ{% else %}–ù–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–æ{% endif %}
                </span>
            </div>
        </div>
        
        <div class="integration-body">
            <div class="features-list">
                <span class="feature-tag"><i class="fa-solid fa-check"></i> –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —Ç–æ–≤–∞—Ä–æ–≤</span>
                <span class="feature-tag"><i class="fa-solid fa-check"></i> –°–æ–∑–¥–∞–Ω–∏–µ –∑–∞–∫–∞–∑–æ–≤</span>
                <span class="feature-tag"><i class="fa-solid fa-check"></i> –£—á—ë—Ç –æ—Å—Ç–∞—Ç–∫–æ–≤</span>
                <span class="feature-tag"><i class="fa-solid fa-check"></i> –ö–æ–Ω—Ç—Ä–∞–≥–µ–Ω—Ç—ã</span>
            </div>
            
            <!-- Disconnected State -->
            <div id="moysklad-disconnected" {% if moysklad and moysklad.is_connected %}style="display:none"{% endif %}>
                <button class="btn-toggle-form" onclick="toggleMoySkladForm()">
                    <i class="fa-solid fa-plug"></i>
                    –ü–æ–¥–∫–ª—é—á–∏—Ç—å –ú–æ–π–°–∫–ª–∞–¥
                </button>
                
                <div class="connection-form" id="moysklad-form">
                    <!-- Connection Method Tabs -->
                    <div class="connection-tabs">
                        <button class="connection-tab active" onclick="switchMoySkladTab('credentials')">–õ–æ–≥–∏–Ω/–ü–∞—Ä–æ–ª—å</button>
                        <button class="connection-tab" onclick="switchMoySkladTab('token')">API –¢–æ–∫–µ–Ω</button>
                    </div>
                    
                    <!-- Credentials Method -->
                    <div class="tab-content active" id="moysklad-credentials-tab">
                        <div class="info-box">
                            <div class="info-box-header">
                                <i class="fa-solid fa-circle-info"></i>
                                <h4>–ö–∞–∫ –ø–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è?</h4>
                            </div>
                            <p>–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –≤–∞—à–∏ —É—á—ë—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –æ—Ç <a href="https://online.moysklad.ru" target="_blank">–ú–æ–π–°–∫–ª–∞–¥</a>. –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º —Å–æ–∑–¥–∞—Ç—å –æ—Ç–¥–µ–ª—å–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —Å –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω—ã–º–∏ –ø—Ä–∞–≤–∞–º–∏ –¥–ª—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏.</p>
                        </div>
                        
                        <div class="form-input-group">
                            <label>–õ–æ–≥–∏–Ω (email –∏–ª–∏ —Ç–µ–ª–µ—Ñ–æ–Ω)</label>
                            <input 
                                type="text" 
                                id="moysklad-login" 
                                class="form-input" 
                                placeholder="user@company.com"
                            >
                        </div>
                        
                        <div class="form-input-group">
                            <label>–ü–∞—Ä–æ–ª—å</label>
                            <input 
                                type="password" 
                                id="moysklad-password" 
                                class="form-input" 
                                placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢"
                            >
                        </div>
                    </div>
                    
                    <!-- Token Method -->
                    <div class="tab-content" id="moysklad-token-tab">
                        <div class="info-box">
                            <div class="info-box-header">
                                <i class="fa-solid fa-circle-info"></i>
                                <h4>–ì–¥–µ –ø–æ–ª—É—á–∏—Ç—å —Ç–æ–∫–µ–Ω?</h4>
                            </div>
                            <ol>
                                <li>–í–æ–π–¥–∏—Ç–µ –≤ <a href="https://online.moysklad.ru" target="_blank">–ú–æ–π–°–∫–ª–∞–¥</a></li>
                                <li>–ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ <strong>–ù–∞—Å—Ç—Ä–æ–π–∫–∏ ‚Üí –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏</strong></li>
                                <li>–í—ã–±–µ—Ä–∏—Ç–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è ‚Üí <strong>–ò–∑–º–µ–Ω–∏—Ç—å</strong></li>
                                <li>–í —Ä–∞–∑–¥–µ–ª–µ "–¢–æ–∫–µ–Ω –¥–æ—Å—Ç—É–ø–∞" –Ω–∞–∂–º–∏—Ç–µ <strong>–°–æ–∑–¥–∞—Ç—å</strong></li>
                            </ol>
                        </div>
                        
                        <div class="form-input-group">
                            <label>API –¢–æ–∫–µ–Ω</label>
                            <input 
                                type="password" 
                                id="moysklad-token" 
                                class="form-input" 
                                placeholder="xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx"
                            >
                        </div>
                    </div>
                    
                    <div id="moysklad-error" class="message-box error" style="display:none">
                        <i class="fa-solid fa-circle-exclamation"></i>
                        <span></span>
                    </div>
                    
                    <div id="moysklad-success" class="message-box success" style="display:none">
                        <i class="fa-solid fa-check-circle"></i>
                        <span></span>
                    </div>
                    
                    <div class="integration-actions">
                        <button class="btn-connect" onclick="connectMoySklad()" id="moysklad-connect-btn">
                            <i class="fa-solid fa-link"></i>
                            –ü–æ–¥–∫–ª—é—á–∏—Ç—å
                        </button>
                    </div>
                </div>
            </div>
            
            <!-- Connected State -->
            <div id="moysklad-connected" {% if not moysklad or not moysklad.is_connected %}style="display:none"{% endif %}>
                <div class="connected-info">
                    <div class="connected-info-row">
                        <span class="connected-info-label">–°—Ç–∞—Ç—É—Å</span>
                        <span class="connected-info-value" style="color: #22c55e;">
                            <i class="fa-solid fa-circle" style="font-size: 8px; margin-right: 6px;"></i>
                            –ê–∫—Ç–∏–≤–Ω–æ
                        </span>
                    </div>
                    <div class="connected-info-row">
                        <span class="connected-info-label">–ê–∫–∫–∞—É–Ω—Ç</span>
                        <span class="connected-info-value" id="moysklad-account">{% if moysklad %}{{ moysklad.domain }}{% endif %}</span>
                    </div>
                    <div class="connected-info-row">
                        <span class="connected-info-label">–û—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—è</span>
                        <span class="connected-info-value" id="moysklad-org">-</span>
                    </div>
                </div>
                
                <div class="stats-row">
                    <div class="stat-mini-card">
                        <div class="stat-value">0</div>
                        <div class="stat-label">–ó–∞–∫–∞–∑–æ–≤ —Å–æ–∑–¥–∞–Ω–æ</div>
                    </div>
                    <div class="stat-mini-card">
                        <div class="stat-value">0</div>
                        <div class="stat-label">–¢–æ–≤–∞—Ä–æ–≤ —Å–∏–Ω—Ö—Ä.</div>
                    </div>
                    <div class="stat-mini-card">
                        <div class="stat-value">100%</div>
                        <div class="stat-label">–£—Å–ø–µ—à–Ω–æ—Å—Ç—å</div>
                    </div>
                </div>
                
                <div class="integration-actions">
                    <button class="btn-test" onclick="testMoySklad()">
                        <i class="fa-solid fa-vial"></i>
                        –¢–µ—Å—Ç
                    </button>
                    <button class="btn-disconnect" onclick="disconnectMoySklad()">
                        <i class="fa-solid fa-unlink"></i>
                        –û—Ç–∫–ª—é—á–∏—Ç—å
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Google Sheets Card -->
    <div class="integration-card {% if google_sheets and google_sheets.is_connected %}connected{% endif %}" id="gsheets-card">
        <div class="integration-header">
            <div class="integration-logo google-sheets">
                <i class="fa-solid fa-table"></i>
            </div>
            <div class="integration-info">
                <h3>Google Sheets</h3>
                <p>–¢–∞–±–ª–∏—Ü—ã –≤ –æ–±–ª–∞–∫–µ</p>
            </div>
            <div class="integration-status">
                <span class="status-pill {% if google_sheets and google_sheets.is_connected %}connected{% else %}disconnected{% endif %}" id="gsheets-status">
                    <span class="status-dot"></span>
                    {% if google_sheets and google_sheets.is_connected %}–ü–æ–¥–∫–ª—é—á–µ–Ω–æ{% else %}–ù–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–æ{% endif %}
                </span>
            </div>
        </div>
        
        <div class="integration-body">
            <div class="features-list">
                <span class="feature-tag"><i class="fa-solid fa-check"></i> –≠–∫—Å–ø–æ—Ä—Ç –ª–∏–¥–æ–≤</span>
                <span class="feature-tag"><i class="fa-solid fa-check"></i> –ê–≤—Ç–æ–∑–∞–ø–∏—Å—å</span>
                <span class="feature-tag"><i class="fa-solid fa-check"></i> –û—Ç—á—ë—Ç—ã</span>
                <span class="feature-tag"><i class="fa-solid fa-check"></i> –§–æ—Ä–º—É–ª—ã</span>
            </div>
            
            <!-- Disconnected State -->
            <div id="gsheets-disconnected" {% if google_sheets and google_sheets.is_connected %}style="display:none"{% endif %}>
                <button class="btn-toggle-form" onclick="toggleGSheetsForm()">
                    <i class="fa-solid fa-plug"></i>
                    –ü–æ–¥–∫–ª—é—á–∏—Ç—å Google Sheets
                </button>
                
                <div class="connection-form" id="gsheets-form">
                    <!-- Connection Method Tabs -->
                    <div class="connection-tabs">
                        <button class="connection-tab active" onclick="switchGSheetsTab('simple')">–ë—ã—Å—Ç—Ä–æ–µ</button>
                        <button class="connection-tab" onclick="switchGSheetsTab('service')">Service Account</button>
                    </div>
                    
                    <!-- Simple Method -->
                    <div class="tab-content active" id="gsheets-simple-tab">
                        <div class="info-box warning">
                            <div class="info-box-header">
                                <i class="fa-solid fa-triangle-exclamation"></i>
                                <h4>–û–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω—ã–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª</h4>
                            </div>
                            <p>–ë—ã—Å—Ç—Ä–æ–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –ø–æ–∑–≤–æ–ª—è–µ—Ç —Ç–æ–ª—å–∫–æ –ø—Ä–æ—Å–º–∞—Ç—Ä–∏–≤–∞—Ç—å —Ç–∞–±–ª–∏—Ü—É. –î–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –∑–∞–ø–∏—Å–∏ –¥–∞–Ω–Ω—ã—Ö –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ Service Account.</p>
                        </div>
                        
                        <div class="form-input-group">
                            <label>URL —Ç–∞–±–ª–∏—Ü—ã Google Sheets</label>
                            <input 
                                type="text" 
                                id="gsheets-url" 
                                class="form-input" 
                                placeholder="https://docs.google.com/spreadsheets/d/..."
                            >
                            <p class="input-hint">–°–∫–æ–ø–∏—Ä—É–π—Ç–µ –ø–æ–ª–Ω—É—é —Å—Å—ã–ª–∫—É –∏–∑ –∞–¥—Ä–µ—Å–Ω–æ–π —Å—Ç—Ä–æ–∫–∏ –±—Ä–∞—É–∑–µ—Ä–∞</p>
                        </div>
                    </div>
                    
                    <!-- Service Account Method -->
                    <div class="tab-content" id="gsheets-service-tab">
                        <div class="info-box">
                            <div class="info-box-header">
                                <i class="fa-solid fa-circle-info"></i>
                                <h4>–ö–∞–∫ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å Service Account?</h4>
                            </div>
                            <ol>
                                <li>–û—Ç–∫—Ä–æ–π—Ç–µ <a href="https://console.cloud.google.com" target="_blank">Google Cloud Console</a></li>
                                <li>–°–æ–∑–¥–∞–π—Ç–µ –ø—Ä–æ–µ–∫—Ç –∏–ª–∏ –≤—ã–±–µ—Ä–∏—Ç–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π</li>
                                <li>–í–∫–ª—é—á–∏—Ç–µ <strong>Google Sheets API</strong></li>
                                <li>–ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ <strong>IAM ‚Üí Service Accounts</strong></li>
                                <li>–°–æ–∑–¥–∞–π—Ç–µ Service Account –∏ —Å–∫–∞—á–∞–π—Ç–µ JSON –∫–ª—é—á</li>
                                <li>–û—Ç–∫—Ä–æ–π—Ç–µ —Ç–∞–±–ª–∏—Ü—É –∏ –ø–æ–¥–µ–ª–∏—Ç–µ—Å—å —Å email —Å–µ—Ä–≤–∏—Å–Ω–æ–≥–æ –∞–∫–∫–∞—É–Ω—Ç–∞</li>
                            </ol>
                        </div>
                        
                        <div class="form-input-group">
                            <label>ID —Ç–∞–±–ª–∏—Ü—ã</label>
                            <input 
                                type="text" 
                                id="gsheets-spreadsheet-id" 
                                class="form-input" 
                                placeholder="1BxiMVs0XRA5nFMdKvBdBZjgmUUqptlbs74OgvE2upms"
                            >
                            <p class="input-hint">ID –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –≤ URL —Ç–∞–±–ª–∏—Ü—ã –º–µ–∂–¥—É /d/ –∏ /edit</p>
                        </div>
                        
                        <div class="form-input-group">
                            <label>–ù–∞–∑–≤–∞–Ω–∏–µ –ª–∏—Å—Ç–∞</label>
                            <input 
                                type="text" 
                                id="gsheets-sheet-name" 
                                class="form-input" 
                                placeholder="–õ–∏—Å—Ç1"
                                value="Sheet1"
                            >
                        </div>
                        
                        <div class="form-input-group">
                            <label>JSON –∫–ª—é—á Service Account</label>
                            <textarea 
                                id="gsheets-credentials" 
                                class="form-input" 
                                rows="6"
                                placeholder='{"type": "service_account", "project_id": "...", ...}'
                                style="font-family: monospace; font-size: 12px;"
                            ></textarea>
                            <p class="input-hint">–í—Å—Ç–∞–≤—å—Ç–µ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ JSON —Ñ–∞–π–ª–∞, —Å–∫–∞—á–∞–Ω–Ω–æ–≥–æ –∏–∑ Google Cloud Console</p>
                        </div>
                    </div>
                    
                    <div id="gsheets-error" class="message-box error" style="display:none">
                        <i class="fa-solid fa-circle-exclamation"></i>
                        <span></span>
                    </div>
                    
                    <div id="gsheets-success" class="message-box success" style="display:none">
                        <i class="fa-solid fa-check-circle"></i>
                        <span></span>
                    </div>
                    
                    <div id="gsheets-warning" class="message-box" style="display:none; background: rgba(245, 158, 11, 0.1); border-color: rgba(245, 158, 11, 0.2); color: #fbbf24;">
                        <i class="fa-solid fa-triangle-exclamation"></i>
                        <span></span>
                    </div>
                    
                    <div class="integration-actions">
                        <button class="btn-connect" onclick="connectGSheets()" id="gsheets-connect-btn">
                            <i class="fa-solid fa-link"></i>
                            –ü–æ–¥–∫–ª—é—á–∏—Ç—å
                        </button>
                    </div>
                </div>
            </div>
            
            <!-- Connected State -->
            <div id="gsheets-connected" {% if not google_sheets or not google_sheets.is_connected %}style="display:none"{% endif %}>
                <div class="connected-info">
                    <div class="connected-info-row">
                        <span class="connected-info-label">–°—Ç–∞—Ç—É—Å</span>
                        <span class="connected-info-value" style="color: #22c55e;">
                            <i class="fa-solid fa-circle" style="font-size: 8px; margin-right: 6px;"></i>
                            –ê–∫—Ç–∏–≤–Ω–æ
                        </span>
                    </div>
                    <div class="connected-info-row">
                        <span class="connected-info-label">–¢–∞–±–ª–∏—Ü–∞</span>
                        <span class="connected-info-value" id="gsheets-name">{% if google_sheets %}{{ google_sheets.sheet_name }}{% endif %}</span>
                    </div>
                    <div class="connected-info-row">
                        <span class="connected-info-label">ID</span>
                        <span class="connected-info-value" id="gsheets-id" style="font-size: 12px; word-break: break-all;">{% if google_sheets %}{{ google_sheets.spreadsheet_id }}{% endif %}</span>
                    </div>
                </div>
                
                <div class="stats-row">
                    <div class="stat-mini-card">
                        <div class="stat-value">0</div>
                        <div class="stat-label">–°—Ç—Ä–æ–∫ –¥–æ–±–∞–≤–ª–µ–Ω–æ</div>
                    </div>
                    <div class="stat-mini-card">
                        <div class="stat-value">0</div>
                        <div class="stat-label">–õ–∏–¥–æ–≤ –∑–∞–ø–∏—Å–∞–Ω–æ</div>
                    </div>
                    <div class="stat-mini-card">
                        <div class="stat-value">100%</div>
                        <div class="stat-label">–£—Å–ø–µ—à–Ω–æ—Å—Ç—å</div>
                    </div>
                </div>
                
                <div class="integration-actions">
                    <a href="https://docs.google.com/spreadsheets/d/" target="_blank" class="btn-test" id="gsheets-open-link">
                        <i class="fa-solid fa-external-link"></i>
                        –û—Ç–∫—Ä—ã—Ç—å
                    </a>
                    <button class="btn-test" onclick="testGSheets()">
                        <i class="fa-solid fa-vial"></i>
                        –¢–µ—Å—Ç
                    </button>
                    <button class="btn-disconnect" onclick="disconnectGSheets()">
                        <i class="fa-solid fa-unlink"></i>
                        –û—Ç–∫–ª—é—á–∏—Ç—å
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Coming Soon Section -->
<div class="glass-card" style="text-align: center; padding: 48px;">
    <div style="width: 64px; height: 64px; background: rgba(99, 102, 241, 0.1); border-radius: 16px; display: flex; align-items: center; justify-content: center; margin: 0 auto 20px;">
        <i class="fa-solid fa-plus" style="font-size: 24px; color: var(--dash-primary);"></i>
    </div>
    <h3 style="margin: 0 0 8px 0;">–°–∫–æ—Ä–æ –ø–æ—è–≤—è—Ç—Å—è</h3>
    <p style="color: var(--dash-text-muted); margin: 0 0 24px 0;">–ú—ã —Ä–∞–±–æ—Ç–∞–µ–º –Ω–∞–¥ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è–º–∏ —Å –¥—Ä—É–≥–∏–º–∏ —Å–µ—Ä–≤–∏—Å–∞–º–∏</p>
    <div style="display: flex; justify-content: center; gap: 12px; flex-wrap: wrap;">
        <span class="feature-tag"><i class="fa-solid fa-m"></i> –ú–µ–≥–∞–ø–ª–∞–Ω</span>
        <span class="feature-tag"><i class="fa-solid fa-envelope"></i> Email —Ä–∞—Å—Å—ã–ª–∫–∏</span>
        <span class="feature-tag"><i class="fa-brands fa-slack"></i> Slack</span>
        <span class="feature-tag"><i class="fa-solid fa-calendar"></i> Calendly</span>
        <span class="feature-tag"><i class="fa-brands fa-trello"></i> Trello</span>
    </div>
</div>

<script>
const csrfToken = '{{ csrf_token }}';
let currentAmoCRMMethod = 'oauth';

// ============================================
// BITRIX24 FUNCTIONS
// ============================================

function toggleBitrixForm() {
    const form = document.getElementById('bitrix-form');
    form.classList.toggle('active');
}

async function connectBitrix24() {
    const webhookUrl = document.getElementById('bitrix-webhook').value.trim();
    const errorDiv = document.getElementById('bitrix-error');
    const successDiv = document.getElementById('bitrix-success');
    const btn = document.getElementById('bitrix-connect-btn');
    
    // Reset messages
    errorDiv.style.display = 'none';
    successDiv.style.display = 'none';
    
    if (!webhookUrl) {
        showError('bitrix', '–í–≤–µ–¥–∏—Ç–µ Webhook URL');
        return;
    }
    
    btn.disabled = true;
    btn.innerHTML = '<i class="fa-solid fa-spinner fa-spin"></i> –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ...';
    
    try {
        const response = await fetch('/dashboard/integrations/api/bitrix24/connect/', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'X-CSRFToken': csrfToken
            },
            body: JSON.stringify({ webhook_url: webhookUrl })
        });
        
        const data = await response.json();
        
        if (data.success) {
            showSuccess('bitrix', data.message);
            setTimeout(() => {
                document.getElementById('bitrix-disconnected').style.display = 'none';
                document.getElementById('bitrix-connected').style.display = 'block';
                document.getElementById('bitrix-status').className = 'status-pill connected';
                document.getElementById('bitrix-status').innerHTML = '<span class="status-dot"></span> –ü–æ–¥–∫–ª—é—á–µ–Ω–æ';
                document.getElementById('bitrix-card').classList.add('connected');
                
                if (data.user_info) {
                    document.getElementById('bitrix-domain').textContent = data.user_info.name || webhookUrl.split('/rest/')[0];
                }
            }, 1500);
        } else {
            showError('bitrix', data.error);
        }
    } catch (error) {
        showError('bitrix', '–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–∏');
        console.error(error);
    } finally {
        btn.disabled = false;
        btn.innerHTML = '<i class="fa-solid fa-link"></i> –ü–æ–¥–∫–ª—é—á–∏—Ç—å';
    }
}

async function disconnectBitrix24() {
    if (!confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ –æ—Ç–∫–ª—é—á–∏—Ç—å Bitrix24?')) return;
    
    try {
        const response = await fetch('/dashboard/integrations/api/bitrix24/disconnect/', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'X-CSRFToken': csrfToken
            }
        });
        
        const data = await response.json();
        
        if (data.success) {
            document.getElementById('bitrix-disconnected').style.display = 'block';
            document.getElementById('bitrix-connected').style.display = 'none';
            document.getElementById('bitrix-form').classList.remove('active');
            document.getElementById('bitrix-status').className = 'status-pill disconnected';
            document.getElementById('bitrix-status').innerHTML = '<span class="status-dot"></span> –ù–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–æ';
            document.getElementById('bitrix-card').classList.remove('connected');
            document.getElementById('bitrix-webhook').value = '';
        }
    } catch (error) {
        alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–∫–ª—é—á–µ–Ω–∏–∏');
    }
}

async function testBitrix24() {
    try {
        const response = await fetch('/dashboard/integrations/api/bitrix24/test/', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'X-CSRFToken': csrfToken
            }
        });
        
        const data = await response.json();
        alert(data.success ? '‚úÖ ' + data.message : '‚ùå ' + data.error);
    } catch (error) {
        alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏');
    }
}

// ============================================
// AMOCRM FUNCTIONS
// ============================================

function toggleAmoCRMForm() {
    const form = document.getElementById('amocrm-form');
    form.classList.toggle('active');
}

function switchAmoCRMTab(method) {
    currentAmoCRMMethod = method;
    
    // Update tabs
    document.querySelectorAll('#amocrm-form .connection-tab').forEach(tab => {
        tab.classList.remove('active');
    });
    event.target.classList.add('active');
    
    // Update content
    document.querySelectorAll('#amocrm-form .tab-content').forEach(content => {
        content.classList.remove('active');
    });
    document.getElementById(`amocrm-${method}-tab`).classList.add('active');
}

async function connectAmoCRM() {
    const errorDiv = document.getElementById('amocrm-error');
    const successDiv = document.getElementById('amocrm-success');
    const btn = document.getElementById('amocrm-connect-btn');
    
    errorDiv.style.display = 'none';
    successDiv.style.display = 'none';
    
    btn.disabled = true;
    btn.innerHTML = '<i class="fa-solid fa-spinner fa-spin"></i> –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ...';
    
    let endpoint, body;
    
    if (currentAmoCRMMethod === 'oauth') {
        const subdomain = document.getElementById('amocrm-subdomain').value.trim();
        const clientId = document.getElementById('amocrm-client-id').value.trim();
        const clientSecret = document.getElementById('amocrm-client-secret').value.trim();
        const authCode = document.getElementById('amocrm-auth-code').value.trim();
        
        if (!subdomain || !clientId || !clientSecret || !authCode) {
            showError('amocrm', '–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –ø–æ–ª—è');
            btn.disabled = false;
            btn.innerHTML = '<i class="fa-solid fa-link"></i> –ü–æ–¥–∫–ª—é—á–∏—Ç—å';
            return;
        }
        
        endpoint = '/dashboard/integrations/api/amocrm/connect/';
        body = {
            subdomain: subdomain,
            client_id: clientId,
            client_secret: clientSecret,
            auth_code: authCode
        };
    } else {
        const subdomain = document.getElementById('amocrm-subdomain-legacy').value.trim();
        const email = document.getElementById('amocrm-email').value.trim();
        const apiKey = document.getElementById('amocrm-api-key').value.trim();
        
        if (!subdomain || !email || !apiKey) {
            showError('amocrm', '–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –ø–æ–ª—è');
            btn.disabled = false;
            btn.innerHTML = '<i class="fa-solid fa-link"></i> –ü–æ–¥–∫–ª—é—á–∏—Ç—å';
            return;
        }
        
        endpoint = '/dashboard/integrations/api/amocrm/connect-simple/';
        body = {
            subdomain: subdomain,
            user_email: email,
            api_key: apiKey
        };
    }
    
    try {
        const response = await fetch(endpoint, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'X-CSRFToken': csrfToken
            },
            body: JSON.stringify(body)
        });
        
        const data = await response.json();
        
        if (data.success) {
            showSuccess('amocrm', data.message);
            setTimeout(() => {
                document.getElementById('amocrm-disconnected').style.display = 'none';
                document.getElementById('amocrm-connected').style.display = 'block';
                document.getElementById('amocrm-status').className = 'status-pill connected';
                document.getElementById('amocrm-status').innerHTML = '<span class="status-dot"></span> –ü–æ–¥–∫–ª—é—á–µ–Ω–æ';
                document.getElementById('amocrm-card').classList.add('connected');
                
                if (data.account_info) {
                    document.getElementById('amocrm-account').textContent = 
                        data.account_info.name || data.account_info.subdomain + '.amocrm.ru';
                }
            }, 1500);
        } else {
            showError('amocrm', data.error);
        }
    } catch (error) {
        showError('amocrm', '–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–∏');
        console.error(error);
    } finally {
        btn.disabled = false;
        btn.innerHTML = '<i class="fa-solid fa-link"></i> –ü–æ–¥–∫–ª—é—á–∏—Ç—å';
    }
}

async function disconnectAmoCRM() {
    if (!confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ –æ—Ç–∫–ª—é—á–∏—Ç—å AmoCRM?')) return;
    
    try {
        const response = await fetch('/dashboard/integrations/api/amocrm/disconnect/', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'X-CSRFToken': csrfToken
            }
        });
        
        const data = await response.json();
        
        if (data.success) {
            document.getElementById('amocrm-disconnected').style.display = 'block';
            document.getElementById('amocrm-connected').style.display = 'none';
            document.getElementById('amocrm-form').classList.remove('active');
            document.getElementById('amocrm-status').className = 'status-pill disconnected';
            document.getElementById('amocrm-status').innerHTML = '<span class="status-dot"></span> –ù–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–æ';
            document.getElementById('amocrm-card').classList.remove('connected');
            
            // Clear form fields
            document.getElementById('amocrm-subdomain').value = '';
            document.getElementById('amocrm-client-id').value = '';
            document.getElementById('amocrm-client-secret').value = '';
            document.getElementById('amocrm-auth-code').value = '';
        }
    } catch (error) {
        alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–∫–ª—é—á–µ–Ω–∏–∏');
    }
}

async function testAmoCRM() {
    alert('‚úÖ –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ');
}

// ============================================
// MOYSKLAD FUNCTIONS
// ============================================

let currentMoySkladMethod = 'credentials';

function toggleMoySkladForm() {
    const form = document.getElementById('moysklad-form');
    form.classList.toggle('active');
}

function switchMoySkladTab(method) {
    currentMoySkladMethod = method;
    
    // Update tabs
    document.querySelectorAll('#moysklad-form .connection-tab').forEach(tab => {
        tab.classList.remove('active');
    });
    event.target.classList.add('active');
    
    // Update content
    document.querySelectorAll('#moysklad-form .tab-content').forEach(content => {
        content.classList.remove('active');
    });
    document.getElementById(`moysklad-${method}-tab`).classList.add('active');
}

async function connectMoySklad() {
    const errorDiv = document.getElementById('moysklad-error');
    const successDiv = document.getElementById('moysklad-success');
    const btn = document.getElementById('moysklad-connect-btn');
    
    errorDiv.style.display = 'none';
    successDiv.style.display = 'none';
    
    btn.disabled = true;
    btn.innerHTML = '<i class="fa-solid fa-spinner fa-spin"></i> –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ...';
    
    let endpoint, body;
    
    if (currentMoySkladMethod === 'credentials') {
        const login = document.getElementById('moysklad-login').value.trim();
        const password = document.getElementById('moysklad-password').value.trim();
        
        if (!login || !password) {
            showError('moysklad', '–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –ø–æ–ª—è');
            btn.disabled = false;
            btn.innerHTML = '<i class="fa-solid fa-link"></i> –ü–æ–¥–∫–ª—é—á–∏—Ç—å';
            return;
        }
        
        endpoint = '/dashboard/integrations/api/moysklad/connect/';
        body = { login, password };
    } else {
        const token = document.getElementById('moysklad-token').value.trim();
        
        if (!token) {
            showError('moysklad', '–í–≤–µ–¥–∏—Ç–µ API —Ç–æ–∫–µ–Ω');
            btn.disabled = false;
            btn.innerHTML = '<i class="fa-solid fa-link"></i> –ü–æ–¥–∫–ª—é—á–∏—Ç—å';
            return;
        }
        
        endpoint = '/dashboard/integrations/api/moysklad/connect-token/';
        body = { token };
    }
    
    try {
        const response = await fetch(endpoint, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'X-CSRFToken': csrfToken
            },
            body: JSON.stringify(body)
        });
        
        const data = await response.json();
        
        if (data.success) {
            showSuccess('moysklad', data.message);
            setTimeout(() => {
                document.getElementById('moysklad-disconnected').style.display = 'none';
                document.getElementById('moysklad-connected').style.display = 'block';
                document.getElementById('moysklad-status').className = 'status-pill connected';
                document.getElementById('moysklad-status').innerHTML = '<span class="status-dot"></span> –ü–æ–¥–∫–ª—é—á–µ–Ω–æ';
                document.getElementById('moysklad-card').classList.add('connected');
                
                if (data.account_info) {
                    document.getElementById('moysklad-account').textContent = data.account_info.name || data.account_info.email;
                    if (data.account_info.organization) {
                        document.getElementById('moysklad-org').textContent = data.account_info.organization;
                    }
                }
            }, 1500);
        } else {
            showError('moysklad', data.error);
        }
    } catch (error) {
        showError('moysklad', '–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–∏');
        console.error(error);
    } finally {
        btn.disabled = false;
        btn.innerHTML = '<i class="fa-solid fa-link"></i> –ü–æ–¥–∫–ª—é—á–∏—Ç—å';
    }
}

async function disconnectMoySklad() {
    if (!confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ –æ—Ç–∫–ª—é—á–∏—Ç—å –ú–æ–π–°–∫–ª–∞–¥?')) return;
    
    try {
        const response = await fetch('/dashboard/integrations/api/moysklad/disconnect/', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'X-CSRFToken': csrfToken
            }
        });
        
        const data = await response.json();
        
        if (data.success) {
            document.getElementById('moysklad-disconnected').style.display = 'block';
            document.getElementById('moysklad-connected').style.display = 'none';
            document.getElementById('moysklad-form').classList.remove('active');
            document.getElementById('moysklad-status').className = 'status-pill disconnected';
            document.getElementById('moysklad-status').innerHTML = '<span class="status-dot"></span> –ù–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–æ';
            document.getElementById('moysklad-card').classList.remove('connected');
            
            // Clear form fields
            document.getElementById('moysklad-login').value = '';
            document.getElementById('moysklad-password').value = '';
            document.getElementById('moysklad-token').value = '';
        }
    } catch (error) {
        alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–∫–ª—é—á–µ–Ω–∏–∏');
    }
}

async function testMoySklad() {
    alert('‚úÖ –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ');
}

// ============================================
// GOOGLE SHEETS FUNCTIONS
// ============================================

let currentGSheetsMethod = 'simple';

function toggleGSheetsForm() {
    const form = document.getElementById('gsheets-form');
    form.classList.toggle('active');
}

function switchGSheetsTab(method) {
    currentGSheetsMethod = method;
    
    // Update tabs
    document.querySelectorAll('#gsheets-form .connection-tab').forEach(tab => {
        tab.classList.remove('active');
    });
    event.target.classList.add('active');
    
    // Update content
    document.querySelectorAll('#gsheets-form .tab-content').forEach(content => {
        content.classList.remove('active');
    });
    document.getElementById(`gsheets-${method}-tab`).classList.add('active');
}

async function connectGSheets() {
    const errorDiv = document.getElementById('gsheets-error');
    const successDiv = document.getElementById('gsheets-success');
    const warningDiv = document.getElementById('gsheets-warning');
    const btn = document.getElementById('gsheets-connect-btn');
    
    errorDiv.style.display = 'none';
    successDiv.style.display = 'none';
    warningDiv.style.display = 'none';
    
    btn.disabled = true;
    btn.innerHTML = '<i class="fa-solid fa-spinner fa-spin"></i> –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ...';
    
    let endpoint, body;
    
    if (currentGSheetsMethod === 'simple') {
        const url = document.getElementById('gsheets-url').value.trim();
        
        if (!url) {
            showError('gsheets', '–í–≤–µ–¥–∏—Ç–µ URL —Ç–∞–±–ª–∏—Ü—ã');
            btn.disabled = false;
            btn.innerHTML = '<i class="fa-solid fa-link"></i> –ü–æ–¥–∫–ª—é—á–∏—Ç—å';
            return;
        }
        
        endpoint = '/dashboard/integrations/api/google-sheets/connect-simple/';
        body = { spreadsheet_url: url };
    } else {
        const spreadsheetId = document.getElementById('gsheets-spreadsheet-id').value.trim();
        const sheetName = document.getElementById('gsheets-sheet-name').value.trim() || 'Sheet1';
        const credentials = document.getElementById('gsheets-credentials').value.trim();
        
        if (!spreadsheetId || !credentials) {
            showError('gsheets', '–ó–∞–ø–æ–ª–Ω–∏—Ç–µ ID —Ç–∞–±–ª–∏—Ü—ã –∏ JSON –∫–ª—é—á');
            btn.disabled = false;
            btn.innerHTML = '<i class="fa-solid fa-link"></i> –ü–æ–¥–∫–ª—é—á–∏—Ç—å';
            return;
        }
        
        endpoint = '/dashboard/integrations/api/google-sheets/connect/';
        body = {
            spreadsheet_id: spreadsheetId,
            sheet_name: sheetName,
            credentials_json: credentials
        };
    }
    
    try {
        const response = await fetch(endpoint, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'X-CSRFToken': csrfToken
            },
            body: JSON.stringify(body)
        });
        
        const data = await response.json();
        
        if (data.success) {
            showSuccess('gsheets', data.message);
            
            if (data.warning) {
                warningDiv.querySelector('span').textContent = data.warning;
                warningDiv.style.display = 'flex';
            }
            
            setTimeout(() => {
                document.getElementById('gsheets-disconnected').style.display = 'none';
                document.getElementById('gsheets-connected').style.display = 'block';
                document.getElementById('gsheets-status').className = 'status-pill connected';
                document.getElementById('gsheets-status').innerHTML = '<span class="status-dot"></span> –ü–æ–¥–∫–ª—é—á–µ–Ω–æ';
                document.getElementById('gsheets-card').classList.add('connected');
                
                if (data.account_info) {
                    const sheetId = data.account_info.spreadsheet_id;
                    document.getElementById('gsheets-id').textContent = sheetId;
                    document.getElementById('gsheets-name').textContent = data.account_info.sheet_name || '–¢–∞–±–ª–∏—Ü–∞';
                    document.getElementById('gsheets-open-link').href = `https://docs.google.com/spreadsheets/d/${sheetId}`;
                }
            }, 2000);
        } else {
            showError('gsheets', data.error);
        }
    } catch (error) {
        showError('gsheets', '–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–∏');
        console.error(error);
    } finally {
        btn.disabled = false;
        btn.innerHTML = '<i class="fa-solid fa-link"></i> –ü–æ–¥–∫–ª—é—á–∏—Ç—å';
    }
}

async function disconnectGSheets() {
    if (!confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ –æ—Ç–∫–ª—é—á–∏—Ç—å Google Sheets?')) return;
    
    try {
        const response = await fetch('/dashboard/integrations/api/google-sheets/disconnect/', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'X-CSRFToken': csrfToken
            }
        });
        
        const data = await response.json();
        
        if (data.success) {
            document.getElementById('gsheets-disconnected').style.display = 'block';
            document.getElementById('gsheets-connected').style.display = 'none';
            document.getElementById('gsheets-form').classList.remove('active');
            document.getElementById('gsheets-status').className = 'status-pill disconnected';
            document.getElementById('gsheets-status').innerHTML = '<span class="status-dot"></span> –ù–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–æ';
            document.getElementById('gsheets-card').classList.remove('connected');
            
            // Clear form fields
            document.getElementById('gsheets-url').value = '';
            document.getElementById('gsheets-spreadsheet-id').value = '';
            document.getElementById('gsheets-credentials').value = '';
        }
    } catch (error) {
        alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–∫–ª—é—á–µ–Ω–∏–∏');
    }
}

async function testGSheets() {
    alert('‚úÖ –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ');
}

// ============================================
// HELPER FUNCTIONS
// ============================================

function showError(crm, message) {
    const errorDiv = document.getElementById(`${crm}-error`);
    errorDiv.querySelector('span').textContent = message;
    errorDiv.style.display = 'flex';
}

function showSuccess(crm, message) {
    const successDiv = document.getElementById(`${crm}-success`);
    successDiv.querySelector('span').textContent = message;
    successDiv.style.display = 'flex';
}
</script>
{% endblock %}