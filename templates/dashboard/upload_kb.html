{% extends 'dashboard/base.html' %}
{% load static %}

{% block title %}–ó–∞–≥—Ä—É–∑–∫–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞ - {{ bot.name }}{% endblock %}

{% block content %}
<div class="container">
    <div class="row justify-content-center">
        <div class="col-md-8">
            <div class="mb-4">
                <a href="{% url 'knowledge_base' bot.id %}" class="btn btn-outline-secondary">
                    <i class="fas fa-arrow-left"></i> –ù–∞–∑–∞–¥ –∫ –±–∞–∑–µ –∑–Ω–∞–Ω–∏–π
                </a>
            </div>

            <div class="card">
                <div class="card-header">
                    <h4 class="mb-0">–ó–∞–≥—Ä—É–∑–∏—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç</h4>
                </div>
                <div class="card-body">
                    {% if messages %}
                        {% for message in messages %}
                        <div class="alert alert-{{ message.tags }} alert-dismissible fade show">
                            {{ message }}
                            <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                        </div>
                        {% endfor %}
                    {% endif %}

                    <form method="post" enctype="multipart/form-data" id="upload-form">
                        {% csrf_token %}
                        
                        <div class="mb-3">
                            <label for="title" class="form-label">–ù–∞–∑–≤–∞–Ω–∏–µ –¥–æ–∫—É–º–µ–Ω—Ç–∞ *</label>
                            <input type="text" name="title" id="title" class="form-control" required placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ –Ω–∞—Å—Ç—Ä–æ–π–∫–µ">
                            <small class="text-muted">–ù–∞–∑–≤–∞–Ω–∏–µ –ø–æ–º–æ–∂–µ—Ç –ª–µ–≥–∫–æ –Ω–∞–π—Ç–∏ –¥–æ–∫—É–º–µ–Ω—Ç</small>
                        </div>

                        <div class="mb-3">
                            <label for="description" class="form-label">–û–ø–∏—Å–∞–Ω–∏–µ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)</label>
                            <textarea name="description" id="description" class="form-control" rows="3" placeholder="–ö—Ä–∞—Ç–∫–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ —Å–æ–¥–µ—Ä–∂–∏–º–æ–≥–æ –¥–æ–∫—É–º–µ–Ω—Ç–∞"></textarea>
                        </div>

                        <div class="mb-3">
                            <label for="file" class="form-label">–§–∞–π–ª *</label>
                            <input type="file" name="file" id="file" class="form-control" required accept=".pdf,.docx,.txt">
                            <small class="text-muted">
                                –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ —Ñ–æ—Ä–º–∞—Ç—ã: PDF, DOCX, TXT<br>
                                –ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π —Ä–∞–∑–º–µ—Ä: 50 –ú–ë
                            </small>
                        </div>

                        <div class="alert alert-info">
                            <i class="fas fa-info-circle"></i> <strong>–ß—Ç–æ –ø—Ä–æ–∏–∑–æ–π–¥–µ—Ç –ø–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏:</strong>
                            <ol class="mb-0 mt-2">
                                <li>–î–æ–∫—É–º–µ–Ω—Ç –±—É–¥–µ—Ç —Å–æ—Ö—Ä–∞–Ω–µ–Ω –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö</li>
                                <li>–¢–µ–∫—Å—Ç –±—É–¥–µ—Ç –∏–∑–≤–ª–µ—á–µ–Ω –∏ –æ—á–∏—â–µ–Ω</li>
                                <li>–î–æ–∫—É–º–µ–Ω—Ç —Ä–∞–∑–æ–±—å–µ—Ç—Å—è –Ω–∞ —Å–º—ã—Å–ª–æ–≤—ã–µ —Ñ—Ä–∞–≥–º–µ–Ω—Ç—ã (—á–∞–Ω–∫–∏)</li>
                                <li>–ö–∞–∂–¥—ã–π —Ñ—Ä–∞–≥–º–µ–Ω—Ç –±—É–¥–µ—Ç –≤–µ–∫—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω —á–µ—Ä–µ–∑ OpenAI API</li>
                                <li>–ë–æ—Ç —Å–º–æ–∂–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —ç—Ç–æ—Ç –¥–æ–∫—É–º–µ–Ω—Ç –¥–ª—è –æ—Ç–≤–µ—Ç–æ–≤</li>
                            </ol>
                        </div>

                        <div class="d-grid gap-2">
                            <button type="submit" class="btn btn-primary btn-lg" id="submit-btn">
                                <i class="fas fa-upload"></i> –ó–∞–≥—Ä—É–∑–∏—Ç—å –∏ –ø—Ä–æ–∏–Ω–¥–µ–∫—Å–∏—Ä–æ–≤–∞—Ç—å
                            </button>
                        </div>
                    </form>

                    <div id="progress-section" class="mt-4" style="display: none;">
                        <div class="alert alert-info">
                            <div class="d-flex align-items-center">
                                <div class="spinner-border spinner-border-sm me-2" role="status">
                                    <span class="visually-hidden">–ó–∞–≥—Ä—É–∑–∫–∞...</span>
                                </div>
                                <div>
                                    <strong>–ò–Ω–¥–µ–∫—Å–∞—Ü–∏—è –¥–æ–∫—É–º–µ–Ω—Ç–∞...</strong><br>
                                    <small>–≠—Ç–æ –º–æ–∂–µ—Ç –∑–∞–Ω—è—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ –º–∏–Ω—É—Ç. –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –ø–æ–¥–æ–∂–¥–∏—Ç–µ.</small>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ RAG -->
            <div class="card mt-4">
                <div class="card-header">
                    <h5 class="mb-0">üí° –ü–æ–¥—Å–∫–∞–∑–∫–∏ –ø–æ –≤—ã–±–æ—Ä—É –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤</h5>
                </div>
                <div class="card-body">
                    <h6>–ö–∞–∫–∏–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã –ø–æ–¥—Ö–æ–¥—è—Ç:</h6>
                    <ul>
                        <li>–ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –∏ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</li>
                        <li>FAQ (—á–∞—Å—Ç–æ –∑–∞–¥–∞–≤–∞–µ–º—ã–µ –≤–æ–ø—Ä–æ—Å—ã)</li>
                        <li>–û–ø–∏—Å–∞–Ω–∏—è –ø—Ä–æ–¥—É–∫—Ç–æ–≤ –∏ —É—Å–ª—É–≥</li>
                        <li>–ü–æ–ª–∏—Ç–∏–∫–∏ –∏ –ø—Ä–∞–≤–∏–ª–∞ –∫–æ–º–ø–∞–Ω–∏–∏</li>
                        <li>–¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏–∏</li>
                    </ul>

                    <h6 class="mt-3">–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏:</h6>
                    <ul>
                        <li>–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —á–µ—Ç–∫—É—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É –¥–æ–∫—É–º–µ–Ω—Ç–∞</li>
                        <li>–ò–∑–±–µ–≥–∞–π—Ç–µ —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π (OCR –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è)</li>
                        <li>–†–∞–∑–±–∏–≤–∞–π—Ç–µ –±–æ–ª—å—à–∏–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã –Ω–∞ —Ç–µ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ —Ä–∞–∑–¥–µ–ª—ã</li>
                        <li>–†–µ–≥—É–ª—è—Ä–Ω–æ –æ–±–Ω–æ–≤–ª—è–π—Ç–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã –∞–∫—Ç—É–∞–ª—å–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
document.getElementById('upload-form').addEventListener('submit', function() {
    document.getElementById('submit-btn').disabled = true;
    document.getElementById('submit-btn').innerHTML = '<span class="spinner-border spinner-border-sm me-2"></span>–ó–∞–≥—Ä—É–∑–∫–∞...';
    document.getElementById('progress-section').style.display = 'block';
});

// –ê–≤—Ç–æ–∑–∞–ø–æ–ª–Ω–µ–Ω–∏–µ –Ω–∞–∑–≤–∞–Ω–∏—è –∏–∑ –∏–º–µ–Ω–∏ —Ñ–∞–π–ª–∞
document.getElementById('file').addEventListener('change', function(e) {
    const titleInput = document.getElementById('title');
    if (!titleInput.value && e.target.files.length > 0) {
        const fileName = e.target.files[0].name;
        // –£–±–∏—Ä–∞–µ–º —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ
        const nameWithoutExt = fileName.substring(0, fileName.lastIndexOf('.')) || fileName;
        titleInput.value = nameWithoutExt;
    }
});
</script>
{% endblock %}