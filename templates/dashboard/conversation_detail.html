{% extends 'dashboard/base.html' %}

{% block title %}Диалог с {{ conversation.user_name }}{% endblock %}

{% block extra_css %}
<style>
.conversation-header {
    background: var(--dash-surface);
    backdrop-filter: blur(20px);
    border: 1px solid var(--dash-border);
    border-radius: 16px;
    padding: 24px;
    margin-bottom: 24px;
}

.conversation-info {
    display: flex;
    align-items: center;
    gap: 16px;
}

.conversation-avatar {
    width: 60px;
    height: 60px;
    background: rgba(99, 102, 241, 0.1);
    border-radius: 14px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 28px;
    color: var(--dash-primary);
}

.conversation-meta h2 {
    font-size: 20px;
    margin: 0 0 4px 0;
}

.conversation-meta p {
    font-size: 14px;
    color: var(--dash-text-muted);
    margin: 0;
}

.messages-container {
    background: var(--dash-surface);
    backdrop-filter: blur(20px);
    border: 1px solid var(--dash-border);
    border-radius: 16px;
    padding: 24px;
    max-height: 600px;
    overflow-y: auto;
}

.message {
    display: flex;
    gap: 12px;
    margin-bottom: 16px;
}

.message.user {
    flex-direction: row-reverse;
}

.message-avatar {
    width: 36px;
    height: 36px;
    border-radius: 10px;
    display: flex;
    align-items: center;
    justify-content: center;
    flex-shrink: 0;
    font-size: 16px;
}

.message.bot .message-avatar {
    background: rgba(99, 102, 241, 0.1);
    color: var(--dash-primary);
}

.message.user .message-avatar {
    background: rgba(168, 85, 247, 0.1);
    color: #a855f7;
}

.message-content {
    max-width: 70%;
}

.message-bubble {
    padding: 12px 16px;
    border-radius: 12px;
    font-size: 14px;
    line-height: 1.6;
}

.message.bot .message-bubble {
    background: rgba(99, 102, 241, 0.1);
    border: 1px solid rgba(99, 102, 241, 0.2);
    border-bottom-left-radius: 4px;
}

.message.user .message-bubble {
    background: rgba(255, 255, 255, 0.05);
    border: 1px solid var(--dash-border);
    border-bottom-right-radius: 4px;
}

.message-time {
    font-size: 11px;
    color: var(--dash-text-muted);
    margin-top: 4px;
}
</style>
{% endblock %}

{% block content %}
<div class="page-header">
    <div>
        <h1 class="page-title">Диалог</h1>
        <p class="page-subtitle">{{ conversation.bot.name }}</p>
    </div>
    <a href="{% url 'conversations_list' %}" class="btn btn-secondary">
        <i class="fa-solid fa-arrow-left"></i>
        Назад
    </a>
</div>

<div class="conversation-header">
    <div class="conversation-info">
        <div class="conversation-avatar">
            <i class="fa-solid fa-user"></i>
        </div>
        <div class="conversation-meta">
            <h2>{{ conversation.user_name|default:"Гость" }}</h2>
            <p>
                Начат {{ conversation.started_at|date:"d.m.Y в H:i" }} · 
                Последнее сообщение {{ conversation.last_message_at|timesince }} назад
            </p>
        </div>
    </div>
</div>

<div class="messages-container">
    {% for msg in messages %}
        <div class="message {% if msg.role == 'user' %}user{% else %}bot{% endif %}">
            <div class="message-avatar">
                {% if msg.role == 'user' %}
                    <i class="fa-solid fa-user"></i>
                {% else %}
                    <i class="fa-solid fa-robot"></i>
                {% endif %}
            </div>
            <div class="message-content">
                <div class="message-bubble">
                    {{ msg.content }}
                </div>
                <div class="message-time">
                    {{ msg.created_at|date:"H:i" }}
                </div>
            </div>
        </div>
    {% empty %}
        <div class="empty-state">
            <p style="color: var(--dash-text-muted);">Сообщений пока нет</p>
        </div>
    {% endfor %}
</div>
{% endblock %}