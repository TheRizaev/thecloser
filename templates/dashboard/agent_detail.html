{% extends 'dashboard/base.html' %}
{% load static %}

{% block title %}{{ bot.name }} ‚Äî –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∞–≥–µ–Ω—Ç–æ–º{% endblock %}

{% block extra_css %}
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
    :root {
        --provider-openai: #10a37f;
        --provider-google: #4285f4;
        --provider-anthropic: #d97757;
        --bg-modal: rgba(0, 0, 0, 0.85);
        --surface-dark: #1e293b;
        --surface-darker: #0f172a;


        --price-cheap: #3b82f6;           /* –°–∏–Ω–∏–π */
        --price-moderate: #10b981;        /* –ó–µ–ª–µ–Ω—ã–π */
        --price-expensive: #f59e0b;       /* –û—Ä–∞–Ω–∂–µ–≤—ã–π/–ó–æ–ª–æ—Ç–æ–π */
        --price-very-expensive: #ef4444;  /* –ö—Ä–∞—Å–Ω—ã–π */
    }

    .bot-detail-container {
        max-width: 1600px;
        margin: 0 auto;
        padding-bottom: 60px;
    }

    /* --- Header Card --- */
    .bot-header-card {
        background: var(--dash-surface);
        border: 1px solid var(--dash-border);
        border-radius: 24px;
        padding: 32px;
        margin-bottom: 32px;
        display: flex;
        gap: 32px;
        position: relative;
        overflow: hidden;
        backdrop-filter: blur(20px);
        align-items: flex-start;
    }

    .bot-header-bg-glow {
        position: absolute;
        top: -50%;
        right: -10%;
        width: 600px;
        height: 600px;
        background: radial-gradient(circle, rgba(99, 102, 241, 0.15) 0%, transparent 70%);
        pointer-events: none;
        z-index: 0;
    }

    .bot-avatar-xl {
        width: 140px;
        height: 140px;
        background: linear-gradient(145deg, rgba(30, 41, 59, 0.8), rgba(15, 23, 42, 0.9));
        border-radius: 30px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 56px;
        flex-shrink: 0;
        border: 1px solid rgba(255, 255, 255, 0.05);
        box-shadow: 0 20px 40px -10px rgba(0, 0, 0, 0.3);
        z-index: 1;
        color: var(--dash-primary);
    }

    .bot-header-info {
        flex: 1;
        z-index: 1;
        display: flex;
        flex-direction: column;
        justify-content: center;
        min-width: 0; /* Fix flex overflow */
    }

    .bot-title-row {
        display: flex;
        justify-content: space-between;
        align-items: flex-start;
        margin-bottom: 16px;
        gap: 20px;
        flex-wrap: wrap;
    }

    .bot-header-info h1 {
        font-size: 36px;
        margin: 0 0 12px 0;
        font-weight: 800;
        letter-spacing: -1px;
        background: linear-gradient(to right, #fff, #94a3b8);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        line-height: 1.2;
    }

    .bot-badges {
        display: flex;
        gap: 12px;
        align-items: center;
        flex-wrap: wrap;
    }

    .status-badge {
        padding: 6px 14px;
        border-radius: 100px;
        font-size: 13px;
        font-weight: 600;
        display: flex;
        align-items: center;
        gap: 8px;
        text-transform: uppercase;
        letter-spacing: 0.5px;
        white-space: nowrap;
    }
    
    .status-badge.active { background: rgba(34, 197, 94, 0.1); color: #4ade80; border: 1px solid rgba(34, 197, 94, 0.2); }
    .status-badge.inactive { background: rgba(239, 68, 68, 0.1); color: #f87171; border: 1px solid rgba(239, 68, 68, 0.2); }

    .header-actions {
        display: flex;
        gap: 12px;
        flex-wrap: wrap;
    }

    /* --- Tabs Styling --- */
    .tabs-container {
        margin-bottom: 32px;
        overflow-x: auto; /* Scroll on mobile */
        padding-bottom: 4px; /* Space for scrollbar */
        -webkit-overflow-scrolling: touch;
    }

    .tabs-nav {
        display: flex;
        gap: 8px;
        padding: 6px;
        background: rgba(15, 23, 42, 0.6);
        border: 1px solid var(--dash-border);
        border-radius: 16px;
        width: fit-content;
        min-width: min-content; /* Ensure tabs don't shrink too much */
    }

    .tab-button {
        padding: 12px 24px;
        border: none;
        background: transparent;
        color: var(--dash-text-muted);
        font-size: 14px;
        font-weight: 600;
        border-radius: 12px;
        cursor: pointer;
        transition: all 0.2s ease;
        display: flex;
        align-items: center;
        gap: 10px;
        white-space: nowrap;
    }

    .tab-button:hover { color: #fff; background: rgba(255, 255, 255, 0.03); }
    
    .tab-button.active {
        background: var(--dash-primary);
        color: white;
        box-shadow: 0 4px 12px rgba(99, 102, 241, 0.4);
    }

    .tab-content { display: none; animation: slideUp 0.3s ease-out; }
    .tab-content.active { display: block; }
    
    @keyframes slideUp {
        from { opacity: 0; transform: translateY(10px); }
        to { opacity: 1; transform: translateY(0); }
    }

    /* --- Configuration Forms --- */
    .config-grid {
        display: grid;
        grid-template-columns: 2fr 1fr;
        gap: 24px;
    }

    .config-card {
        background: var(--dash-surface);
        border: 1px solid var(--dash-border);
        border-radius: 20px;
        padding: 28px;
        margin-bottom: 24px;
    }

    .form-group { margin-bottom: 24px; }
    
    .form-label {
        display: block;
        font-size: 13px;
        font-weight: 700;
        margin-bottom: 10px;
        color: var(--dash-text-muted);
        text-transform: uppercase;
        letter-spacing: 0.5px;
    }

    .form-input, .form-textarea, .form-select {
        width: 100%;
        background: var(--surface-darker);
        border: 1px solid var(--dash-border);
        border-radius: 12px;
        padding: 16px;
        color: #fff;
        font-size: 15px;
        transition: border-color 0.2s;
        max-width: 100%;
    }

    .form-input:focus, .form-textarea:focus, .form-select:focus {
        outline: none;
        border-color: var(--dash-primary);
        box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.15);
    }

    /* Model Select Styling */
    .optgroup-openai { color: var(--provider-openai); font-weight: 800; background: #1e293b; }
    .optgroup-google { color: var(--provider-google); font-weight: 800; background: #1e293b; }
    .optgroup-anthropic { color: var(--provider-anthropic); font-weight: 800; background: #1e293b; }
    option { color: #fff; font-weight: normal; padding: 10px; }

    /* Prompt Preview */
    .prompt-preview-box {
        background: var(--surface-darker);
        border: 1px dashed var(--dash-border);
        border-radius: 16px;
        padding: 24px;
        min-height: 140px;
        cursor: pointer;
        transition: all 0.2s;
        position: relative;
    }
    .prompt-preview-box:hover {
        border-color: var(--dash-primary);
        background: rgba(15, 23, 42, 0.8);
    }
    .prompt-preview-text {
        font-family: 'JetBrains Mono', 'Fira Code', monospace;
        color: var(--dash-text-muted);
        font-size: 13px;
        line-height: 1.6;
        display: -webkit-box;
        -webkit-line-clamp: 6;
        -webkit-box-orient: vertical;
        overflow: hidden;
    }

    /* --- FULLSCREEN MODAL --- */
    .modal-overlay {
        position: fixed;
        top: 0; left: 0; width: 100vw; height: 100vh;
        background: var(--bg-modal);
        backdrop-filter: blur(8px);
        z-index: 2147483647; 
        display: none;
        align-items: center;
        justify-content: center;
        opacity: 0;
        transition: opacity 0.3s ease;
    }

    .modal-overlay.open { display: flex; opacity: 1; }

    .modal-content {
        background: var(--surface-dark);
        width: 90vw; height: 90vh;
        border-radius: 20px;
        border: 1px solid rgba(255, 255, 255, 0.1);
        box-shadow: 0 50px 100px -20px rgba(0, 0, 0, 0.7);
        display: flex; flex-direction: column;
        transform: scale(0.95);
        transition: transform 0.3s cubic-bezier(0.16, 1, 0.3, 1);
    }

    .modal-overlay.open .modal-content { transform: scale(1); }

    .modal-header {
        padding: 24px 32px;
        border-bottom: 1px solid var(--dash-border);
        display: flex; justify-content: space-between; align-items: center;
        background: var(--surface-darker);
        border-radius: 20px 20px 0 0;
    }

    .modal-body {
        flex: 1 1 auto;
        display: flex; flex-direction: column;
        padding: 0; position: relative;
        background: #0f172a;
        overflow: hidden; height: 100%;
    }

    .fullscreen-textarea {
        flex: 1; width: 100% !important; max-width: 100% !important; height: 100%;
        background: transparent; border: none; padding: 32px;
        color: #e2e8f0; font-family: 'JetBrains Mono', 'Fira Code', monospace;
        font-size: 16px; line-height: 1.7; resize: none; outline: none;
        box-sizing: border-box;
    }
    
    /* --- Knowledge Base Tab Styles --- */
    .kb-list { display: flex; flex-direction: column; gap: 12px; }
    
    .kb-item {
        display: flex; align-items: center; padding: 16px;
        background: rgba(255, 255, 255, 0.02);
        border: 1px solid var(--dash-border);
        border-radius: 16px; transition: all 0.2s;
    }
    
    .kb-item:hover {
        background: rgba(255, 255, 255, 0.04);
        border-color: rgba(255, 255, 255, 0.1);
        transform: translateX(4px);
    }

    .kb-icon {
        width: 48px; height: 48px; border-radius: 12px;
        display: flex; align-items: center; justify-content: center;
        font-size: 20px; margin-right: 20px; flex-shrink: 0;
    }
    
    .kb-icon.pdf { background: rgba(239, 68, 68, 0.1); color: #ef4444; }
    .kb-icon.docx { background: rgba(59, 130, 246, 0.1); color: #3b82f6; }
    .kb-icon.txt { background: rgba(148, 163, 184, 0.1); color: #94a3b8; }

    /* --- Analytics Tab Styles --- */
    .analytics-grid-top {
        display: grid; grid-template-columns: repeat(4, 1fr); gap: 20px; margin-bottom: 24px;
    }
    
    .kpi-card {
        background: var(--dash-surface);
        border: 1px solid var(--dash-border);
        border-radius: 16px; padding: 20px;
    }
    
    .chart-box-large {
        background: var(--dash-surface);
        border: 1px solid var(--dash-border);
        border-radius: 20px; padding: 24px;
        height: 400px; margin-bottom: 24px;
    }

    /* --- Conversation Tab Styles --- */
    .conv-table { width: 100%; border-collapse: separate; border-spacing: 0 8px; }
    
    .conv-row { background: rgba(255, 255, 255, 0.02); transition: background 0.2s; }
    .conv-row:hover { background: rgba(255, 255, 255, 0.04); }
    
    .conv-cell {
        padding: 16px;
        border-top: 1px solid var(--dash-border);
        border-bottom: 1px solid var(--dash-border);
    }
    
    .conv-cell:first-child {
        border-left: 1px solid var(--dash-border);
        border-top-left-radius: 12px; border-bottom-left-radius: 12px;
    }
    
    .conv-cell:last-child {
        border-right: 1px solid var(--dash-border);
        border-top-right-radius: 12px; border-bottom-right-radius: 12px;
    }

    /* RAG Card */
    .rag-card {
        background: linear-gradient(145deg, rgba(30, 41, 59, 0.4), rgba(15, 23, 42, 0.6));
        border: 1px solid var(--dash-border);
        border-radius: 16px; padding: 20px;
        display: flex; align-items: center; gap: 20px;
        margin-top: 24px; position: relative; overflow: hidden;
        transition: all 0.3s ease;
    }

    .rag-card:hover {
        border-color: var(--dash-primary);
        box-shadow: 0 8px 24px -6px rgba(99, 102, 241, 0.25);
        transform: translateY(-2px);
    }
    
    .rag-card::before {
        content: ''; position: absolute; top: 0; left: 0; bottom: 0;
        width: 4px; background: var(--dash-primary); opacity: 0.7;
    }

    .rag-icon {
        width: 48px; height: 48px;
        background: rgba(99, 102, 241, 0.1); color: var(--dash-primary);
        border-radius: 12px; display: flex; align-items: center; justify-content: center;
        font-size: 20px; border: 1px solid rgba(99, 102, 241, 0.2); flex-shrink: 0;
    }

    .rag-content { flex: 1; min-width: 0; }

    .rag-title {
        font-size: 15px; font-weight: 700; color: #fff;
        margin-bottom: 4px; display: flex; align-items: center; gap: 8px; flex-wrap: wrap;
    }

    .rag-desc { font-size: 13px; color: var(--dash-text-muted); line-height: 1.4; }

    .pro-badge {
        font-size: 10px; background: rgba(99, 102, 241, 0.2); 
        color: #818cf8; padding: 2px 6px; border-radius: 4px;
        border: 1px solid rgba(99, 102, 241, 0.3);
    }

    /* Toggle Switch */
    .toggle-switch {
        position: relative; display: inline-block; width: 52px; height: 28px; flex-shrink: 0;
    }
    
    .toggle-switch input { opacity: 0; width: 0; height: 0; }
    
    .toggle-slider {
        position: absolute; cursor: pointer; top: 0; left: 0; right: 0; bottom: 0;
        background-color: #334155; transition: .4s; border-radius: 34px;
        border: 1px solid rgba(255,255,255,0.1);
    }
    
    .toggle-slider:before {
        position: absolute; content: ""; height: 20px; width: 20px;
        left: 3px; bottom: 3px; background-color: white;
        transition: .4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        border-radius: 50%; box-shadow: 0 2px 4px rgba(0,0,0,0.2);
    }
    
    input:checked + .toggle-slider {
        background-color: var(--dash-primary); border-color: transparent;
        box-shadow: 0 0 10px rgba(99, 102, 241, 0.4);
    }
    
    input:checked + .toggle-slider:before { transform: translateX(24px); }

    .form-select.price-cheap {
        border-color: var(--price-cheap);
        box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.15);
    }

    .form-select.price-moderate {
        border-color: var(--price-moderate);
        box-shadow: 0 0 0 3px rgba(16, 185, 129, 0.15);
    }

    .form-select.price-expensive {
        border-color: var(--price-expensive);
        box-shadow: 0 0 0 3px rgba(245, 158, 11, 0.15);
    }

    .form-select.price-very-expensive {
        border-color: var(--price-very-expensive);
        box-shadow: 0 0 0 3px rgba(239, 68, 68, 0.15);
    }

    .model-price-hint {
        margin-top: 8px;
        font-size: 12px;
        line-height: 1.4;
        padding: 8px 12px;
        border-radius: 8px;
        display: flex;
        align-items: center;
        gap: 8px;
        font-weight: 600;
    }

    .model-price-hint.cheap {
        background: rgba(59, 130, 246, 0.1);
        color: var(--price-cheap);
        border: 1px solid rgba(59, 130, 246, 0.3);
    }

    /* --- RESPONSIVE MEDIA QUERIES --- */
    @media (max-width: 1024px) {
        .config-grid { grid-template-columns: 1fr; }
        .analytics-grid-top { grid-template-columns: repeat(2, 1fr); }
    }

    @media (max-width: 768px) {
        .bot-header-card {
            flex-direction: column;
            align-items: center;
            text-align: center;
            padding: 24px;
        }

        .bot-avatar-xl {
            width: 100px;
            height: 100px;
            font-size: 40px;
        }

        .bot-title-row {
            flex-direction: column;
            align-items: center;
            gap: 16px;
        }

        .header-actions {
            justify-content: center;
            width: 100%;
        }
        
        .header-actions .btn {
            flex: 1; /* –ö–Ω–æ–ø–∫–∏ –Ω–∞ –≤—Å—é —à–∏—Ä–∏–Ω—É –≤–Ω—É—Ç—Ä–∏ flex */
            justify-content: center;
        }

        .bot-badges {
            justify-content: center;
        }

        .bot-header-info h1 {
            font-size: 28px;
        }

        .tabs-nav {
            width: 100%;
            overflow-x: auto;
        }

        .analytics-grid-top {
            grid-template-columns: 1fr;
        }

        .modal-content {
            width: 100vw;
            height: 100vh;
            border-radius: 0;
        }
        
        .modal-header {
            padding: 16px 20px;
        }
        
        .modal-header h3 {
            font-size: 16px;
        }
        
        .modal-header .btn {
            padding: 8px 12px;
            font-size: 13px;
        }
        
        .fullscreen-textarea {
            padding: 20px;
            font-size: 14px;
        }
        
        /* –¢–∞–±–ª–∏—Ü–∞ –¥–∏–∞–ª–æ–≥–æ–≤ –Ω–∞ –º–æ–±–∏–ª—å–Ω—ã—Ö */
        .conv-table, .conv-table tbody, .conv-table tr, .conv-table td {
            display: block;
            width: 100%;
        }
        
        .conv-row {
            margin-bottom: 16px;
            border: 1px solid var(--dash-border);
            border-radius: 16px;
            overflow: hidden;
        }
        
        .conv-cell {
            border: none;
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
            padding: 12px 16px;
        }
        
        .conv-cell:first-child { border: none; padding-bottom: 0; }
        .conv-cell:last-child { border: none; text-align: center; background: rgba(0,0,0,0.2); }
        
        /* –°–∫—Ä—ã–≤–∞–µ–º –ø—É—Å—Ç—ã–µ —è—á–µ–π–∫–∏ –µ—Å–ª–∏ –Ω—É–∂–Ω–æ –∏–ª–∏ –º–µ–Ω—è–µ–º –∏—Ö –≤–∏–¥ */
    }
</style>
{% endblock %}

{% block content %}
<div class="bot-detail-container">

    <div class="bot-header-card">
        <div class="bot-header-bg-glow"></div>
        
        <div class="bot-avatar-xl">
            {% if bot.platform == 'telegram' %}
                <i class="fa-brands fa-telegram" style="color: #229ED9;"></i>
            {% elif bot.platform == 'whatsapp' %}
                <i class="fa-brands fa-whatsapp" style="color: #25D366;"></i>
            {% elif bot.platform == 'vk' %}
                <i class="fa-brands fa-vk" style="color: #0077FF;"></i>
            {% else %}
                <i class="fa-solid fa-robot"></i>
            {% endif %}
        </div>

        <div class="bot-header-info">
            <div class="bot-title-row">
                <div>
                    <h1>{{ bot.name }}</h1>
                    <div class="bot-badges">
                        <div class="status-badge {% if bot.status == 'active' %}active{% else %}inactive{% endif %}">
                            <i class="fa-solid fa-circle" style="font-size: 8px;"></i>
                            {% if bot.status == 'active' %}–ê–∫—Ç–∏–≤–µ–Ω{% else %}–û—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω{% endif %}
                        </div>
                        <span style="color: var(--dash-text-muted); font-size: 13px;">
                            <i class="fa-solid fa-microchip"></i> {{ bot.openai_model }}
                        </span>
                        <span style="color: var(--dash-text-muted); font-size: 13px;">
                            <i class="fa-solid fa-clock"></i> {{ bot.created_at|date:"d.m.Y" }}
                        </span>
                    </div>
                </div>
                
                <div class="header-actions">
                     {% if bot.platform == 'telegram' %}
                        {% if bot.session_string %}
                        <a href="https://t.me/{{ bot.telegram_username }}" target="_blank" class="btn btn-primary" style="background: #229ED9; border-color: #229ED9;">
                            <i class="fa-brands fa-telegram"></i> Telegram
                        </a>
                        {% else %}
                        <a href="{% url 'telegram_connect' bot.id %}" class="btn btn-secondary">
                            <i class="fa-solid fa-link"></i> –ü–æ–¥–∫–ª—é—á–∏—Ç—å
                        </a>

                        {% endif %}
                    {% endif %}
                        <a href="{% url 'bot_test_chat' bot.id %}" class="btn btn-secondary">
                            <i class="fa-solid fa-comment-dots"></i> –¢–µ—Å—Ç-—á–∞—Ç
                        </a>
                    <button class="btn btn-secondary" onclick="toggleBotStatus()">
                        <i class="fa-solid fa-power-off"></i> 
                        {% if bot.status == 'active' %}–°—Ç–æ–ø{% else %}–ü—É—Å–∫{% endif %}
                    </button>
                </div>
            </div>
            
            <p style="color: var(--dash-text-muted); font-size: 15px; margin: 0; max-width: 800px; line-height: 1.5;">
                {{ bot.description|default:"–ù–µ—Ç –æ–ø–∏—Å–∞–Ω–∏—è. –î–æ–±–∞–≤—å—Ç–µ –µ–≥–æ –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö, —á—Ç–æ–±—ã –ª—É—á—à–µ –ø–æ–Ω–∏–º–∞—Ç—å –Ω–∞–∑–Ω–∞—á–µ–Ω–∏–µ –∞–≥–µ–Ω—Ç–∞." }}
            </p>
        </div>
    </div>

    <div class="tabs-container">
        <div class="tabs-nav">
            <button class="tab-button active" onclick="switchTab('config')">
                <i class="fa-solid fa-sliders"></i> –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –∏ AI
            </button>
            <button class="tab-button" onclick="switchTab('analytics')">
                <i class="fa-solid fa-chart-pie"></i> –ê–Ω–∞–ª–∏—Ç–∏–∫–∞
            </button>
            <button class="tab-button" onclick="switchTab('knowledge')">
                <i class="fa-solid fa-database"></i> –ë–∞–∑–∞ –∑–Ω–∞–Ω–∏–π
            </button>
            <button class="tab-button" onclick="switchTab('conversations')">
                <i class="fa-solid fa-comments"></i> –î–∏–∞–ª–æ–≥–∏
            </button>
        </div>
    </div>

    <div id="tab-config" class="tab-content active">
        <form method="POST" action="{% url 'agent_detail' bot.id %}" id="botConfigForm">
            {% csrf_token %}
            
            <div class="config-grid">
                <div>
                    <div class="config-card" style="margin-bottom: 24px; border-color: rgba(99, 102, 241, 0.4);">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                            <h3 style="margin: 0; display: flex; align-items: center; gap: 12px; font-size: 18px;">
                                <i class="fa-solid fa-wand-magic-sparkles" style="color: var(--dash-primary);"></i>
                                –°–∏—Å—Ç–µ–º–Ω—ã–π –ø—Ä–æ–º–ø—Ç
                            </h3>
                            <button type="button" class="btn btn-secondary btn-sm" onclick="openEditor()">
                                <i class="fa-solid fa-expand"></i> <span class="hide-mobile">–†–∞–∑–≤–µ—Ä–Ω—É—Ç—å</span>
                            </button>
                        </div>

                        <textarea name="system_prompt" id="realPromptInput" style="display: none;">{{ bot.system_prompt }}</textarea>

                        <div class="prompt-preview-box" onclick="openEditor()">
                            <div class="prompt-preview-text" id="promptPreviewText">{{ bot.system_prompt }}</div>
                        </div>
                    </div>

                    <div class="config-card">
                        <h3 style="margin-top: 0;">–û—Å–Ω–æ–≤–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è</h3>
                        
                        <div class="form-group">
                            <label class="form-label">–ù–∞–∑–≤–∞–Ω–∏–µ –∞–≥–µ–Ω—Ç–∞</label>
                            <input type="text" name="name" class="form-input" value="{{ bot.name }}" required>
                        </div>

                        <div class="form-group">
                            <label class="form-label">–ù–∞–∑–≤–∞–Ω–∏–µ –∫–æ–º–ø–∞–Ω–∏–∏</label>
                            <input 
                                type="text" 
                                name="company_name" 
                                class="form-input" 
                                value="{{ bot.company_name|default:'TheCloser' }}" 
                                placeholder="TheCloser"
                            >
                            <div style="margin-top: 6px; font-size: 12px; color: var(--dash-text-muted);">
                                <i class="fa-solid fa-circle-info"></i> –û—Ç –ª–∏—Ü–∞ –∫–∞–∫–æ–π –∫–æ–º–ø–∞–Ω–∏–∏ –≤—ã—Å—Ç—É–ø–∞–µ—Ç –±–æ—Ç
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">–û–ø–∏—Å–∞–Ω–∏–µ</label>
                            <textarea name="description" class="form-textarea" rows="3">{{ bot.description }}</textarea>
                        </div>

                        <div class="rag-card">
                            <div class="rag-icon">
                                <i class="fa-solid fa-database"></i>
                            </div>
                            
                            <div class="rag-content">
                                <div class="rag-title">
                                    –ë–∞–∑–∞ –ó–Ω–∞–Ω–∏–π (RAG)
                                    <span class="pro-badge">PRO</span>
                                </div>
                                <div class="rag-desc">
                                    –ò—Å–∫–∞—Ç—å –æ—Ç–≤–µ—Ç—ã –≤ —Ñ–∞–π–ª–∞—Ö –ø–µ—Ä–µ–¥ –≥–µ–Ω–µ—Ä–∞—Ü–∏–µ–π.
                                </div>
                            </div>
                            <div class="form-group" id="ragKGroup" style="display: {% if bot.use_rag %}block{% else %}none{% endif %};">
                                <label class="form-label">
                                    –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ñ—Ä–∞–≥–º–µ–Ω—Ç–æ–≤ –¥–ª—è –ø–æ–∏—Å–∫–∞ (RAG Top K)
                                    <i class="fa-solid fa-circle-info" title="–°–∫–æ–ª—å–∫–æ —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã—Ö —Ñ—Ä–∞–≥–º–µ–Ω—Ç–æ–≤ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∏–∑ –±–∞–∑—ã –∑–Ω–∞–Ω–∏–π"></i>
                                </label>
                                <div style="display: flex; align-items: center; gap: 16px;">
                                    <input 
                                        type="range" 
                                        name="rag_k" 
                                        min="1" 
                                        max="10" 
                                        step="1" 
                                        value="{{ bot.rag_top_k|default:'5' }}" 
                                        style="flex: 1;" 
                                        oninput="ragKDisplay.innerText = this.value"
                                    >
                                    <span id="ragKDisplay" style="font-family: monospace; font-weight: bold; font-size: 16px; color: var(--dash-primary); width: 30px; text-align: right;">
                                        {{ bot.rag_top_k|default:'5' }}
                                    </span>
                                </div>
                                <div style="margin-top: 6px; font-size: 12px; color: var(--dash-text-muted);">
                                    üí° –ë–æ–ª—å—à–µ —Ñ—Ä–∞–≥–º–µ–Ω—Ç–æ–≤ = –±–æ–ª—å—à–µ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞, –Ω–æ –≤—ã—à–µ —Å—Ç–æ–∏–º–æ—Å—Ç—å —Ç–æ–∫–µ–Ω–æ–≤
                                </div>
                            </div>
                            <label class="toggle-switch">
                                <input type="checkbox" name="use_rag" {% if bot.use_rag %}checked{% endif %}>
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                    </div>
                </div>

                <div>
                    <div class="config-card" style="height: auto;">
                        <h3 style="margin-top: 0;">–ú–æ–¥–µ–ª—å –∏–Ω—Ç–µ–ª–ª–µ–∫—Ç–∞</h3>
                        
                        <div class="form-group">
                            <label class="form-label">LLM –ü—Ä–æ–≤–∞–π–¥–µ—Ä –∏ –ú–æ–¥–µ–ª—å</label>
                            <select name="model" class="form-select" id="aiModelSelect" onchange="updateModelColor()">
                                {% for value, label in bot.MODEL_CHOICES %}
                                    <option value="{{ value }}" {% if bot.openai_model == value %}selected{% endif %}>
                                        {{ label }}
                                    </option>
                                {% endfor %}
                            </select>
                            <div class="model-price-hint" id="modelHint"></div>
                        </div>

                        <div class="form-group">
                            <label class="form-label">–¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞ (–ö—Ä–µ–∞—Ç–∏–≤–Ω–æ—Å—Ç—å)</label>
                            <div style="display: flex; align-items: center; gap: 16px;">
                                <input type="range" name="temperature" min="0" max="2" step="0.1" value="{{ bot.temperature|default:'0.7' }}" style="flex: 1;" oninput="tempDisplay.innerText = this.value">
                                <span id="tempDisplay" style="font-family: monospace; font-weight: bold; font-size: 16px; color: var(--dash-primary); width: 30px; text-align: right;">{{ bot.temperature|default:'0.7' }}</span>
                            </div>
                        </div>

                        <div class="form-group">
                            <label class="form-label">–õ–∏–º–∏—Ç —Ç–æ–∫–µ–Ω–æ–≤</label>
                            <input type="number" name="max_tokens" class="form-input" value="{{ bot.max_tokens|default:'1000' }}">
                        </div>

                        <button type="submit" class="btn btn-primary" style="width: 100%; justify-content: center; margin-top: 12px; height: 48px; font-size: 16px;">
                            <i class="fa-solid fa-floppy-disk"></i> –°–æ—Ö—Ä–∞–Ω–∏—Ç—å
                        </button>
                    </div>

                    <div style="margin-top: 24px; border: 1px solid rgba(239, 68, 68, 0.3); background: rgba(239, 68, 68, 0.05); border-radius: 16px; padding: 20px;">
                        <h4 style="margin: 0 0 12px 0; color: #ef4444;">–û–ø–∞—Å–Ω–∞—è –∑–æ–Ω–∞</h4>
                        <button type="button" class="btn btn-secondary" onclick="deleteBot()" style="width: 100%; border-color: #ef4444; color: #ef4444;">
                            <i class="fa-solid fa-trash"></i> –£–¥–∞–ª–∏—Ç—å –∞–≥–µ–Ω—Ç–∞
                        </button>
                    </div>
                </div>
            </div>
        </form>
    </div>

    <div id="tab-analytics" class="tab-content">
        <div class="analytics-grid-top">
            <div class="kpi-card">
                <div style="color: var(--dash-text-muted); font-size: 13px; margin-bottom: 8px;">–í—Å–µ–≥–æ –¥–∏–∞–ª–æ–≥–æ–≤</div>
                <div style="font-size: 28px; font-weight: 800; color: #fff;">{{ bot.conversations_count }}</div>
                <div style="color: #4ade80; font-size: 12px; margin-top: 4px;">
                    <i class="fa-solid fa-arrow-up"></i> 12% –∑–∞ –Ω–µ–¥–µ–ª—é
                </div>
            </div>
            
            <div class="kpi-card">
                <div style="color: var(--dash-text-muted); font-size: 13px; margin-bottom: 8px;">–í—Å–µ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏–π</div>
                <div style="font-size: 28px; font-weight: 800; color: #fff;">{{ bot.total_messages|default:0 }}</div>
            </div>

            <div class="kpi-card">
                <div style="color: var(--dash-text-muted); font-size: 13px; margin-bottom: 8px;">–õ–∏–¥—ã</div>
                <div style="font-size: 28px; font-weight: 800; color: #fff;">{{ bot.leads_count }}</div>
                <div style="color: #4ade80; font-size: 12px; margin-top: 4px;">CR: 5.2%</div>
            </div>

            <div class="kpi-card">
                <div style="color: var(--dash-text-muted); font-size: 13px; margin-bottom: 8px;">–ë–∞–∑–∞ –∑–Ω–∞–Ω–∏–π</div>
                <div style="font-size: 28px; font-weight: 800; color: #fff;">{{ bot.knowledge_count }} <span style="font-size: 14px; font-weight: normal; color: var(--dash-text-muted);">—Ñ–∞–π–ª–æ–≤</span></div>
            </div>
        </div>

        <div class="chart-box-large">
            <div style="display: flex; justify-content: space-between; margin-bottom: 20px;">
                <h3 style="margin: 0;">–ê–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –¥–∏–∞–ª–æ–≥–æ–≤</h3>
                <select class="form-select" style="width: auto; padding: 6px 12px; min-width: 120px;" id="chartPeriod" onchange="loadChart()">
                    <option value="7days">7 –¥–Ω–µ–π</option>
                    <option value="30days">30 –¥–Ω–µ–π</option>
                </select>
            </div>
            <div style="height: 300px; width: 100%; position: relative;">
                <canvas id="analyticsChart"></canvas>
            </div>
        </div>
    </div>

    <div id="tab-knowledge" class="tab-content">
        <div class="config-card">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 24px;">
                <h3 style="margin: 0;">–§–∞–π–ª—ã –±–∞–∑—ã –∑–Ω–∞–Ω–∏–π</h3>
                <a href="{% url 'upload_knowledge' %}?bot_id={{ bot.id }}" class="btn btn-primary">
                    <i class="fa-solid fa-cloud-arrow-up"></i> <span class="hide-mobile">–ó–∞–≥—Ä—É–∑–∏—Ç—å —Ñ–∞–π–ª</span>
                </a>
            </div>

            {% if knowledge_files %}
                <div class="kb-list">
                    {% for file in knowledge_files %}
                    <div class="kb-item">
                        <div class="kb-icon {{ file.file_type }}">
                            {% if file.file_type == 'pdf' %}<i class="fa-solid fa-file-pdf"></i>
                            {% elif file.file_type == 'docx' %}<i class="fa-solid fa-file-word"></i>
                            {% else %}<i class="fa-solid fa-file-lines"></i>{% endif %}
                        </div>
                        <div style="flex: 1; min-width: 0;">
                            <div style="font-weight: 600; font-size: 16px; margin-bottom: 4px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">{{ file.title }}</div>
                            <div style="font-size: 12px; color: var(--dash-text-muted);">
                                {{ file.file_size_display }} ‚Ä¢ {{ file.created_at|date:"d M, H:i" }}
                            </div>
                        </div>
                        <div style="display: flex; align-items: center; gap: 10px;">
                            {% if file.is_indexed %}
                                <span class="status-badge active hide-mobile"><i class="fa-solid fa-check"></i> –ò–Ω–¥–µ–∫—Å</span>
                            {% else %}
                                <span class="status-badge inactive hide-mobile"><i class="fa-solid fa-clock"></i></span>
                            {% endif %}
                            
                            <a href="{% url 'knowledge_detail' file.id %}" class="btn btn-secondary btn-sm" style="width: 36px; height: 36px; padding: 0; display: flex; align-items: center; justify-content: center;">
                                <i class="fa-solid fa-eye"></i>
                            </a>
                        </div>
                    </div>
                    {% endfor %}
                </div>
                
                <div style="margin-top: 24px; text-align: center;">
                    <a href="{% url 'knowledge_base_list' %}" class="btn btn-secondary">
                        –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –≤—Å–µ —Ñ–∞–π–ª—ã ({{ bot.knowledge_count }})
                    </a>
                </div>
            {% else %}
                <div style="text-align: center; padding: 60px 20px;">
                    <i class="fa-solid fa-folder-open" style="font-size: 48px; color: var(--dash-border); margin-bottom: 20px;"></i>
                    <h4 style="margin: 0 0 8px 0;">–ë–∞–∑–∞ –∑–Ω–∞–Ω–∏–π –ø—É—Å—Ç–∞</h4>
                    <p style="color: var(--dash-text-muted); margin-bottom: 24px; max-width: 400px; margin-left: auto; margin-right: auto;">–ó–∞–≥—Ä—É–∑–∏—Ç–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã, —á—Ç–æ–±—ã –±–æ—Ç –º–æ–≥ –æ—Ç–≤–µ—á–∞—Ç—å –Ω–∞ –≤–æ–ø—Ä–æ—Å—ã –≤–∞—à–∏—Ö –∫–ª–∏–µ–Ω—Ç–æ–≤.</p>
                    <a href="{% url 'upload_knowledge' %}?bot_id={{ bot.id }}" class="btn btn-primary">–ó–∞–≥—Ä—É–∑–∏—Ç—å –ø–µ—Ä–≤—ã–π —Ñ–∞–π–ª</a>
                </div>
            {% endif %}
        </div>
    </div>

    <div id="tab-conversations" class="tab-content">
        <div class="config-card" style="padding: 0; overflow: hidden;">
            <div style="padding: 24px; border-bottom: 1px solid var(--dash-border); display: flex; justify-content: space-between; align-items: center;">
                <h3 style="margin: 0;">–ò—Å—Ç–æ—Ä–∏—è –¥–∏–∞–ª–æ–≥–æ–≤</h3>
                <a href="{% url 'conversations_list' %}?bot={{ bot.id }}" class="btn btn-secondary btn-sm">–í—Å—è –∏—Å—Ç–æ—Ä–∏—è</a>
            </div>

            {% if recent_conversations %}
            <div style="overflow-x: auto;">
                <table class="conv-table">
                    <tbody>
                        {% for conv in recent_conversations %}
                        <tr class="conv-row">
                            <td class="conv-cell" style="width: 60px; padding-right: 0;">
                                <div style="width: 40px; height: 40px; background: rgba(99, 102, 241, 0.1); border-radius: 50%; display: flex; align-items: center; justify-content: center; color: var(--dash-primary);">
                                    <i class="fa-solid fa-user"></i>
                                </div>
                            </td>
                            <td class="conv-cell">
                                <div style="font-weight: 600; margin-bottom: 4px;">{{ conv.user_name|default:conv.user_id|truncatechars:20 }}</div>
                                <div style="font-size: 13px; color: var(--dash-text-muted);">
                                    {% if conv.is_lead %}
                                        <span style="color: #4ade80; margin-right: 8px;"><i class="fa-solid fa-bullseye"></i> –õ–∏–¥</span>
                                    {% endif %}
                                    {{ conv.last_message|truncatechars:40|default:"–ù–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–π" }}
                                </div>
                            </td>
                            <td class="conv-cell" style="text-align: right; white-space: nowrap; color: var(--dash-text-muted); font-size: 13px;">
                                {{ conv.last_message_at|timesince }} –Ω–∞–∑–∞–¥
                            </td>
                            <td class="conv-cell" style="width: 60px;">
                                <a href="{% url 'conversation_detail' conv.id %}" class="btn-icon" style="text-decoration: none;">
                                    <i class="fa-solid fa-chevron-right"></i>
                                </a>
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
            {% else %}
                <div style="padding: 40px; text-align: center; color: var(--dash-text-muted);">
                    –î–∏–∞–ª–æ–≥–æ–≤ –ø–æ–∫–∞ –Ω–µ—Ç. –ü–æ–¥–∫–ª—é—á–∏—Ç–µ –±–æ—Ç–∞ –∫ –º–µ—Å—Å–µ–Ω–¥–∂–µ—Ä—É –∏ –Ω–∞–ø–∏—à–∏—Ç–µ –µ–º—É.
                </div>
            {% endif %}
        </div>
    </div>

</div>

<div class="modal-overlay" id="editorModal">
    <div class="modal-content">
        <div class="modal-header">
            <h3 style="margin: 0; color: #fff; font-size: 18px;">
                <i class="fa-solid fa-code" style="margin-right: 8px;"></i> –†–µ–¥–∞–∫—Ç–æ—Ä –ø—Ä–æ–º–ø—Ç–∞
            </h3>
            <div style="display: flex; gap: 8px;">
                <button type="button" class="btn btn-secondary" onclick="closeEditor()" style="padding: 8px 16px;">–û—Ç–º–µ–Ω–∞</button>
                <button type="button" class="btn btn-primary" onclick="saveEditor()" style="padding: 8px 16px;">
                    <i class="fa-solid fa-check"></i>
                </button>
            </div>
        </div>
        <div class="modal-body">
            <textarea id="modalTextarea" class="fullscreen-textarea" spellcheck="false" placeholder="–í–≤–µ–¥–∏—Ç–µ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –¥–ª—è AI –∑–¥–µ—Å—å...">{{ bot.system_prompt }}</textarea>
        </div>
        <div style="padding: 12px 20px; background: #0f172a; border-top: 1px solid var(--dash-border); font-size: 12px; color: var(--dash-text-muted); display: flex; justify-content: space-between;">
            <span>Markdown –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è</span>
            <span>{{ bot.name }}</span>
        </div>
    </div>
</div>

<script>
    const csrfToken = '{{ csrf_token }}';
    const botId = {{ bot.id }};

    const modal = document.getElementById('editorModal');
    const textarea = document.getElementById('modalTextarea');
    const realInput = document.getElementById('realPromptInput');
    const preview = document.getElementById('promptPreviewText');

    document.querySelector('input[name="use_rag"]').addEventListener('change', function() {
        const ragKGroup = document.getElementById('ragKGroup');
        ragKGroup.style.display = this.checked ? 'block' : 'none';
    });

    function openEditor() {
        document.body.appendChild(modal);
        textarea.value = realInput.value;
        modal.classList.add('open');
        document.body.style.overflow = 'hidden';
        
        // –§–æ–∫—É—Å —Å –Ω–µ–±–æ–ª—å—à–æ–π –∑–∞–¥–µ—Ä–∂–∫–æ–π –¥–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö
        setTimeout(() => textarea.focus(), 100);
    }

    function closeEditor() {
        modal.classList.remove('open');
        document.body.style.overflow = '';
    }

    function saveEditor() {
        const val = textarea.value;
        realInput.value = val;
        preview.innerText = val;
        closeEditor();
    }

    // Tabs Logic
    function switchTab(tabId) {
        document.querySelectorAll('.tab-content').forEach(el => el.classList.remove('active'));
        document.querySelectorAll('.tab-button').forEach(el => el.classList.remove('active'));
        
        document.getElementById('tab-' + tabId).classList.add('active');
        // –ù–∞—Ö–æ–¥–∏–º –∫–Ω–æ–ø–∫—É –ø–æ —Ç–µ–∫—Å—Ç—É –∏–ª–∏ –∏–∫–æ–Ω–∫–µ, —Ç–∞–∫ –∫–∞–∫ event.currentTarget –º–æ–∂–µ—Ç –±—ã—Ç—å –Ω–µ –¥–æ—Å—Ç—É–ø–µ–Ω –µ—Å–ª–∏ –≤—ã–∑–æ–≤ –ø—Ä–æ–≥—Ä–∞–º–º–Ω—ã–π
        const btns = document.querySelectorAll('.tab-button');
        // –ü—Ä–æ—Å—Ç–∞—è –ª–æ–≥–∏–∫–∞ –¥–ª—è –¥–µ–º–æ:
        if (event && event.currentTarget) {
            event.currentTarget.classList.add('active');
        }

        if (tabId === 'analytics') {
            setTimeout(loadChart, 100); // –î–∞–µ–º –≤—Ä–µ–º—è –Ω–∞ –æ—Ç—Ä–∏—Å–æ–≤–∫—É DOM
        }
    }

    // Model Color Logic
    function updateModelColor() {
        const select = document.getElementById('aiModelSelect');
        const selectedText = select.options[select.selectedIndex].text;
        const hint = document.getElementById('modelHint');
        
        // –£–¥–∞–ª—è–µ–º –≤—Å–µ –∫–ª–∞—Å—Å—ã —Ü–µ–Ω—ã
        select.classList.remove('price-cheap', 'price-moderate', 'price-expensive', 'price-very-expensive');
        hint.className = 'model-price-hint';
        
        // –û–ø—Ä–µ–¥–µ–ª—è–µ–º –∫–∞—Ç–µ–≥–æ—Ä–∏—é –ø–æ —Ç–µ–∫—Å—Ç—É –≤ —Å–∫–æ–±–∫–∞—Ö
        if (selectedText.includes('(Cheap)')) {
            select.classList.add('price-cheap');
            hint.classList.add('cheap');
            hint.innerHTML = '<i class="fa-solid fa-dollar-sign"></i> –î–µ—à–µ–≤–∞—è –º–æ–¥–µ–ª—å ‚Äî –º–∏–Ω–∏–º–∞–ª—å–Ω–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å –∑–∞–ø—Ä–æ—Å–æ–≤';
        } else if (selectedText.includes('(Moderate)')) {
            select.classList.add('price-moderate');
            hint.classList.add('moderate');
            hint.innerHTML = '<i class="fa-solid fa-dollar-sign"></i><i class="fa-solid fa-dollar-sign"></i> –°–±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –º–æ–¥–µ–ª—å ‚Äî –æ–ø—Ç–∏–º–∞–ª—å–Ω–æ–µ —Å–æ–æ—Ç–Ω–æ—à–µ–Ω–∏–µ —Ü–µ–Ω—ã –∏ –∫–∞—á–µ—Å—Ç–≤–∞';
        } else if (selectedText.includes('(Expensive)')) {
            select.classList.add('price-expensive');
            hint.classList.add('expensive');
            hint.innerHTML = '<i class="fa-solid fa-dollar-sign"></i><i class="fa-solid fa-dollar-sign"></i><i class="fa-solid fa-dollar-sign"></i> –ü—Ä–æ–¥–≤–∏–Ω—É—Ç–∞—è –º–æ–¥–µ–ª—å ‚Äî –≤—ã—Å–æ–∫–æ–µ –∫–∞—á–µ—Å—Ç–≤–æ –æ—Ç–≤–µ—Ç–æ–≤';
        } else if (selectedText.includes('(Very Expensive)')) {
            select.classList.add('price-very-expensive');
            hint.classList.add('very-expensive');
            hint.innerHTML = '<i class="fa-solid fa-dollar-sign"></i><i class="fa-solid fa-dollar-sign"></i><i class="fa-solid fa-dollar-sign"></i><i class="fa-solid fa-dollar-sign"></i> –ü—Ä–µ–º–∏—É–º –º–æ–¥–µ–ª—å ‚Äî –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –∫–∞—á–µ—Å—Ç–≤–æ –∏ —Å–∫–æ—Ä–æ—Å—Ç—å';
        }
    }
    updateModelColor();

    // Bot Actions
    async function toggleBotStatus() {
        if(!confirm('–ü–µ—Ä–µ–∫–ª—é—á–∏—Ç—å —Å—Ç–∞—Ç—É—Å –±–æ—Ç–∞?')) return;
        try {
            const res = await fetch(`/api/agents/${botId}/toggle/`, {
                method: 'POST',
                headers: { 'X-CSRFToken': csrfToken }
            });
            if (res.ok) location.reload();
        } catch(e) { alert('–û—à–∏–±–∫–∞ —Å–µ—Ç–∏'); }
    }

    async function deleteBot() {
        const check = prompt(`–í–≤–µ–¥–∏—Ç–µ "${'{{ bot.name|escapejs }}'}" –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è:`);
        if (check === '{{ bot.name|escapejs }}') {
             try {
                const res = await fetch(`/api/agents/${botId}/delete/`, {
                    method: 'DELETE',
                    headers: { 'X-CSRFToken': csrfToken }
                });
                if (res.ok) window.location.href = "{% url 'agents_list' %}";
            } catch(e) { alert('–û—à–∏–±–∫–∞ —Å–µ—Ç–∏'); }
        }
    }

    // Chart Init
    let chartInstance = null;
    function loadChart() {
        const ctx = document.getElementById('analyticsChart');
        if(!ctx || chartInstance) return;

        const gradient = ctx.getContext('2d').createLinearGradient(0, 0, 0, 300);
        gradient.addColorStop(0, 'rgba(99, 102, 241, 0.4)');
        gradient.addColorStop(1, 'rgba(99, 102, 241, 0)');

        chartInstance = new Chart(ctx, {
            type: 'line',
            data: {
                labels: ['–ü–Ω', '–í—Ç', '–°—Ä', '–ß—Ç', '–ü—Ç', '–°–±', '–í—Å'],
                datasets: [{
                    label: '–î–∏–∞–ª–æ–≥–∏',
                    data: [12, 19, 3, 5, 2, 3, 10], 
                    borderColor: '#6366f1',
                    backgroundColor: gradient,
                    borderWidth: 2,
                    fill: true,
                    tension: 0.4,
                    pointBackgroundColor: '#1e293b',
                    pointBorderColor: '#6366f1',
                    pointBorderWidth: 2
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: { legend: { display: false } },
                scales: {
                    y: { grid: { color: 'rgba(255,255,255,0.05)' }, ticks: { color: '#94a3b8' } },
                    x: { grid: { display: false }, ticks: { color: '#94a3b8' } }
                }
            }
        });
    }
</script>
{% endblock %}